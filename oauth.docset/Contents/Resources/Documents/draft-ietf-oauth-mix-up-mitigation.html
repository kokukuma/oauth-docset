<!DOCTYPE html>
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html --><html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>
  
    draft-ietf-oauth-mix-up-mitigation-01
  
</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>
<!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.38.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.38.0/respond/dest/respond.min.js"></script>
    <![endif]-->
<link href="/feed/document-changes/draft-ietf-oauth-mix-up-mitigation/" rel="alternate" title="Document changes" type="application/atom+xml"/>
<meta content="OAuth 2.0 Mix-Up Mitigation (Internet-Draft, 2016)" name="description"/>
<script src="https://www.ietf.org/lib/dt/7.38.0/d3/d3.min.js"></script>
<script src="https://www.ietf.org/lib/dt/7.38.0/jquery/jquery.min.js"></script>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/ietf-icon-blue3.png" rel="shortcut icon"/>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/apple-touch-icon.png" rel="apple-touch-icon"/>
</head>
<body style="padding-top: 0;">
<div class="content" id="content">
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
<div class="rfcmarkup">
<div class="noprint" style="height: 6px;">
<div class="meta-info bgred" onclick="showLegend();" onmouseout="hideLegend()" onmouseover="this.style.cursor='pointer';" style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; " title="Click for colour legend."> </div>
<div class="meta-info noprint pre legend" id="legend" onmouseout="hideLegend();" onmouseover="showLegend();" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
</div>
</div>
<div class="noprint">
<pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-mix-up-mitigation-01.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-mix-up-mitigation-01.xml" title="XML source for this document">xml</a>|<a href="https://tools.ietf.org/pdf/draft-ietf-oauth-mix-up-mitigation-01.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/draft-ietf-oauth-mix-up-mitigation/01/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/draft-ietf-oauth-mix-up-mitigation/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/oauth/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-oauth-mix-up-mitigation@ietf.org?subject=draft-ietf-oauth-mix-up-mitigation" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=draft-ietf-oauth-mix-up-mitigation-01.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-oauth-mix-up-mitigation-01.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-oauth-mix-up-mitigation-01.txt" title="Run an idnits check of this document">Nits</a>]

Versions: (<a href="/doc/html/draft-jones-oauth-mix-up-mitigation">draft-jones-oauth-mix-up-mitigation</a>)                         
          <a href="/doc/html/draft-ietf-oauth-mix-up-mitigation-00">00</a> <a href="/doc/html/draft-ietf-oauth-mix-up-mitigation-01"><b>01</b></a>                                                         </pre>
</div>
<div class="draftcontent">
<pre>OAuth Working Group                                             M. Jones
Internet-Draft                                                 Microsoft
Intended status: Standards Track                              J. Bradley
Expires: January 7, 2017                                   Ping Identity
                                                             N. Sakimura
                                                                     NRI
                                                            July 6, 2016


                      <span class="h1">OAuth 2.0 Mix-Up Mitigation</span>
                 <span class="h1">draft-ietf-oauth-mix-up-mitigation-01</span>

Abstract

   This specification defines an extension to The OAuth 2.0
   Authorization Framework that enables the authorization server to
   dynamically provide the client using it with additional information
   about the current protocol interaction that can be validated by the
   client and that enables the client to dynamically provide the
   authorization server with additional information about the current
   protocol interaction that can be validated by the authorization
   server.  This additional information can be used by the client and
   the authorization server to prevent classes of attacks in which the
   client might otherwise be tricked into using inconsistent sets of
   metadata from multiple authorization servers, including potentially
   using a token endpoint that does not belong to the same authorization
   server as the authorization endpoint used.  Recent research
   publications refer to these as "IdP Mix-Up" and "Malicious Endpoint"
   attacks.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="/doc/html/bcp78">BCP 78</a> and <a href="/doc/html/bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 7, 2017.





<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Requirements Notation and Conventions . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.2">1.2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  The OAuth Issuer Identifier . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Mitigation Data Returned in Authorization Response  . . . . .   <a href="#page-5">5</a>
     3.1.  Mitigation Data Returned in Authorization Response
           Parameters  . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
       3.1.1.  Example Authorization Response using Response
               Parameters  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-3.2">3.2</a>.  Mitigation Data Returned in JWT . . . . . . . . . . . . .   <a href="#page-6">6</a>
       <a href="#section-3.2.1">3.2.1</a>.  Example Authorization Response using JWT  . . . . . .   <a href="#page-6">6</a>
   <a href="#section-4">4</a>.  Validating the Authorization Response . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-5">5</a>.  Mitigation Data Sent to the Token Endpoint  . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-5.1">5.1</a>.  Example Token Request . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-6">6</a>.  Validating the Token Request  . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-7">7</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-7.1">7.1</a>.  IdP Mix-Up and Malicious Endpoint Attacks . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-7.2">7.2</a>.  Duplicate Information Attacks . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-7.3">7.3</a>.  Cut-and-Paste Attacks . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#section-8">8</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-8.1">8.1</a>.  OAuth Parameters Registration . . . . . . . . . . . . . .  <a href="#page-11">11</a>
       <a href="#section-8.1.1">8.1.1</a>.  Registry Contents . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-9">9</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-9.1">9.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
     <a href="#section-9.2">9.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#appendix-A">Appendix A</a>.  Implementation Notes . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#appendix-B">Appendix B</a>.  Acknowledgements . . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#appendix-C">Appendix C</a>.  Open Issues  . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#appendix-D">Appendix D</a>.  Document History . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>




<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.%20%20Introduction"></a></body></html><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>] clients use multiple authorization server
   endpoints when using some OAuth response types.  For instance, when
   using the "code" response type, the client uses both the
   authorization endpoint and the token endpoint.  It is important that
   endpoints belonging to the same authorization server always be used
   together.  Otherwise, information produced by one authorization
   server could mistakenly be sent by the client to different
   authorization server, resulting in some of the attacks described in
   <a href="#section-7">Section 7</a>.  Recent research publications refer to these specific
   attacks as "IdP Mix-Up" [<a href="#ref-arXiv.1601.01229v2">arXiv.1601.01229v2</a>] and "Malicious Endpoint"
   [<a href="#ref-arXiv.1508.04324v2">arXiv.1508.04324v2</a>] attacks.

   The client obviously cannot be confused into using endpoints from
   multiple authorization servers in an authorization flow if the client
   is configured to use only a single authorization server.  However,
   the client can potentially be tricked into mixing endpoints if it is
   configured to use more than one authorization server, whether the
   configuration is dynamic or static.  The client may be confused if it
   has no way to determine whether the set of endpoints belongs to the
   same authorization server.  Or, a client may be confused simply
   because it is receiving authorization responses from more than one
   authorization server at the same redirection endpoint and the client
   is insufficiently able to determine that the response received is
   associated with the correct authorization server.

   This specification enables the authorization server to dynamically
   provide the client using it with additional information about the
   current protocol interaction that can be validated by the client and
   that enables the client to dynamically provide the authorization
   server with additional information about the current protocol
   interaction that can be validated by the authorization server.  This
   enables them to abort interactions in which endpoints from multiple
   authorization servers would otherwise be used.

   The mitigation data provided by the authorization server to the
   client is an issuer identifier, which is used to identify the
   authorization server, and a client ID, which is used to verify that
   the response is from the correct authorization server and is intended
   for this client.  The issuer identifier is defined in Section 2 of
   [<a href="#ref-OAuth.Discovery">OAuth.Discovery</a>].  If supported by the authorization server, the
   issuer identifier can also be used to obtain a consistent set of
   metadata describing the authorization server configuration, as also
   described in [<a href="#ref-OAuth.Discovery">OAuth.Discovery</a>].

   This mitigation data is returned to the client in the authorization
   response.  The syntax for returning the mitigation data from the



<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   authorization server is dependent upon the OAuth response type being
   used.  The syntax used with the existing response types registered in
   the IANA "OAuth Authorization Endpoint Response Types" registry
   [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>] as of the time of this writing is defined by
   this specification.  Two of these response types are defined by <a href="/doc/html/rfc6749">RFC</a>
   <a href="/doc/html/rfc6749">6749</a> [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>]; the rest are defined by [<a href="#ref-OAuth.Responses">OAuth.Responses</a>].

   The mitigation data provided by the client to the authorization
   server is the existing "state" value defined by <a href="/doc/html/rfc6749">RFC 6749</a> [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>],
   but adding also sending it from the client to the token endpoint.
   This is used by the authorization server to verify that the
   authorization code and state both belong to the same protocol
   interaction.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.1.%20%20Requirements%20Notation%20and%20Conventions"></a></body></html><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Requirements Notation and Conventions</span>

   The key words "<em>MUST</em>", "<em>MUST NOT</em>", "<em>REQUIRED</em>", "<em>SHALL</em>", "<em>SHALL NOT</em>",
   "<em>SHOULD</em>", "<em>SHOULD NOT</em>", "<em>RECOMMENDED</em>", "NOT <em>RECOMMENDED</em>", "<em>MAY</em>", and
   "<em>OPTIONAL</em>" in this document are to be interpreted as described in <a href="/doc/html/rfc2119">RFC</a>
   <a href="/doc/html/rfc2119">2119</a> [<a href="/doc/html/rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.2.%20%20Terminology"></a></body></html><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Terminology</span>

   This specification uses the terms "Access Token", "Authorization
   Code", "Authorization Endpoint", "Authorization Grant",
   "Authorization Server", "Client", "Client Authentication", "Client
   Identifier", "Client Secret", "Grant Type", "Protected Resource",
   "Redirection URI", "Refresh Token", "Resource Owner", "Resource
   Server", "Response Type", and "Token Endpoint" defined by OAuth 2.0
   [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>], the terms "Claim Name", "Claim Value", and "JSON Web Token
   (JWT)" defined by JSON Web Token (JWT) [<a href="#ref-JWT" title='"JSON Web Token (JWT)"'>JWT</a>].

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.%20%20The%20OAuth%20Issuer%20Identifier"></a></body></html><a class="selflink" href="#section-2" id="section-2">2</a>.  The OAuth Issuer Identifier</span>

   The OAuth issuer identifier serves as a concrete identifier for the
   authorization server.  As defined in [<a href="#ref-OAuth.Discovery">OAuth.Discovery</a>], the issuer
   identifier is a URL that uses the "https" scheme and has no query or
   fragment components.  Also as specified there, this is the location
   where ".well-known" <a href="/doc/html/rfc5785">RFC 5785</a> [<a href="/doc/html/rfc5785" title='"Defining Well-Known Uniform Resource Identifiers (URIs)"'>RFC5785</a>] resources containing
   information about the authorization server are published.  In
   particular, when discovery is supported, the authorization server's
   metadata is retrieved as a JSON document [<a href="/doc/html/rfc7159" title='"The JavaScript Object Notation (JSON) Data Interchange Format"'>RFC7159</a>] from a path
   derived from this URL.  This metadata document contains a consistent
   set of metadata describing the authorization server configuration.

   Implementations supporting this specification <em>MAY</em> also support
   discovery or they <em>MAY</em> simply use the issuer identifier as a concrete
   identifier for the authorization server.  This specification does not



<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   rely upon the authorization server publishing or the client
   retrieving a discovery metadata document.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.%20%20Mitigation%20Data%20Returned%20in%20Authorization%20Response"></a></body></html><a class="selflink" href="#section-3" id="section-3">3</a>.  Mitigation Data Returned in Authorization Response</span>

   Mitigating the attacks relies on the authorization server returning
   additional data about the interaction and the client checking that
   data.  The mitigation data returned is the client ID and the issuer
   identifier.  The syntax for returning the mitigation data from the
   authorization server is dependent upon the OAuth response type being
   used.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.1.%20%20Mitigation%20Data%20Returned%20in%20Authorization%20Response%20Parameters"></a></body></html><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Mitigation Data Returned in Authorization Response Parameters</span>

   Some OAuth response types do not already return the issuer identifier
   and client ID in the authorization response.  When this is the case,
   the mitigation data is returned as additional OAuth response
   parameters.

   These new response parameters are defined for this purpose:

   client_id
      Client that this response is intended for.  It <em>MUST</em> contain the
      OAuth 2.0 client ID of the client as its value.

   iss
      Issuer identifier for the authorization server issuing the
      response.  The "iss" value is a case-sensitive URL using the
      "https" scheme that contains scheme, host, and optionally, port
      number and path components and no query or fragment components.

   As of the time of this writing, these are the existing response types
   that are registered in the IANA "OAuth Authorization Endpoint
   Response Types" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>] that do not already
   return the issuer identifier and client ID in the authorization
   response: "code", "code token", "none", and "token".  Therefore, the
   client ID and issuer are returned using the new authorization
   response parameters when using these response types.  To avoid
   duplication, as discussed in <a href="#section-7.2">Section 7.2</a>, it is NOT <em>RECOMMENDED</em> to
   also return them in this manner when the response type already
   returns these values in the authorization response.

<span class="h4"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.1.1.%20%20Example%20Authorization%20Response%20using%20Response%20Parameters"></a></body></html><a class="selflink" href="#section-3.1.1" id="section-3.1.1">3.1.1</a>.  Example Authorization Response using Response Parameters</span>

   The following example authorization response is to a request that
   used the "code" response type.  It uses the "iss" and "client_id"
   response parameters to return the mitigation information to the
   client.



<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   The example successful authorization response follows (with line
   breaks within lines for display purposes only):

     HTTP/1.1 302 Found
     Location: https://client.example.org/cb?
       code=Qcb0Orv1zh30vL1MPRsbm-diHiMwcLyZvn1arpZv-Jxf_11jnpEX3Tgfvk
       &amp;state=nrsz6AnHzPSVVBYRVTXV6ZTXQeg_eih7hdpewHNXmZ8
       &amp;iss=https://server.example.com
       &amp;client_id=5d9e8a36-569d-4c40-8d6b-6e279ac1c5f1

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.2.%20%20Mitigation%20Data%20Returned%20in%20JWT"></a></body></html><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Mitigation Data Returned in JWT</span>

   As of the time of this writing, these are the existing response types
   that are registered in the IANA "OAuth Authorization Endpoint
   Response Types" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>] that already return
   the issuer identifier and client ID in the authorization response:
   "code id_token", "code id_token token", "id_token", and
   "id_token token".  All of these return these values as the "iss"
   (issuer) claim value and as an "aud" (audience) claim value in a
   signed ID Token, which is a JSON Web Token [<a href="#ref-JWT" title='"JSON Web Token (JWT)"'>JWT</a>], as specified in
   "OpenID Connect Core 1.0" [<a href="#ref-OpenID.Core">OpenID.Core</a>].  When using these response
   types, the client <em>MUST</em> use the client ID and issuer values returned
   in the ID Token for validating the mitigation data.

<span class="h4"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.2.1.%20%20Example%20Authorization%20Response%20using%20JWT"></a></body></html><a class="selflink" href="#section-3.2.1" id="section-3.2.1">3.2.1</a>.  Example Authorization Response using JWT</span>

   The following example authorization response is to a request that
   used the "id_token token" response type.  It uses the "iss" and "aud"
   claims in the ID Token to return the mitigation information to the
   client.





















<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   The example successful authorization response follows (with line
   breaks within lines for display purposes only):

     HTTP/1.1 302 Found
     Location: https://client.example.org/cb#
       access_token=jHkWEdUXMU1BwAsC4vtUsZwnNvTIxEl0z9K3vx5KF0Y
       &amp;token_type=Bearer
       &amp;id_token=eyJraWQiOiIxZTlnZGs3IiwiYWxnIjoiUlMyNTYifQ.
       ewogImlzcyI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmNvbSIsCiAic3ViIjog
       IjI0ODI4OTc2MTAwMSIsCiAiYXVkIjogInM2QmhkUmtxdDMiLAogIm5vbmNlIjog
       Im4tMFM2X1d6QTJNaiIsCiAiZXhwIjogMTMxMTI4MTk3MCwKICJpYXQiOiAxMzEx
       MjgwOTcwLAogImF0X2hhc2giOiAiNzdRbVVQdGpQZnpXdEYyQW5wSzlSUSIKfQ.
       kdqTmftlaXg5WBYBr1wkxhkqCGZPc0k8vTiV5g2jj67jQ7XkrDamYx2bOkZLdZrp
       MPIzkdYB1nZI_G8vQGQuamRhJcEIt21kblGPZ-yhEhdkAiZIZLu38rChalDS2Mh0
       glE_rke5XXRhmqqoEFFdziFdnO3p61-7y51co84OEAZvARSINQaOWIzvioRfs4zw
       IFOaT33Vpxfqr8HDyh31zo9eBW2dSQuCa071z0ENWChWoPliK1JCo_Bk9eDg2uwo
       2ZwhsvHzj6TMQ0lYOTzufSlSmXIKfjlOsb3nftQeR697_hA-nMZyAdL8_NRfaC37
       XnAbW8WB9wCfECp7cuNuOg
       &amp;state=af0ifjsldkj

   Decoding the ID Token in the response will yield the following
   claims, which includes the mitigation information in the "iss" and
   "aud" claims:

     {
      "iss": "https://server.example.com",
      "sub": "248289761001",
      "aud": "s6BhdRkqt3",
      "nonce": "n-0S6_WzA2Mj",
      "exp": 1311281970,
      "iat": 1311280970,
      "at_hash": "77QmUPtjPfzWtF2AnpK9RQ"
     }

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.%20%20Validating%20the%20Authorization%20Response"></a></body></html><a class="selflink" href="#section-4" id="section-4">4</a>.  Validating the Authorization Response</span>

   Upon receiving the mitigation data in an authorization response, the
   client <em>MUST</em> validate that the response was intended for it and that
   the authorization server metadata that it obtained at client
   registration time is consistent with the authorization server
   metadata contained in the metadata referenced by the issuer
   identifier.

   The client <em>MUST</em> validate the authorization server configuration as
   follows:

   1.  Compare the issuer identifier for the authorization server that
       the client received when it registered at the authorization



<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


       server that it made the request to with the issuer value returned
       in the "iss" response parameter or the "iss" claim in the ID
       Token, depending upon the response type being used.  If they do
       not exactly match, the client <em>MUST NOT</em> proceed with the
       authorization.

   2.  Verify that the response is intended for this client by
       confirming that the client's client identifier for the
       authorization server the request was made to matches the value of
       the "client_id" response parameter or that the client's client
       identifier is an audience value of the ID Token, depending upon
       the response type being used.  If not, the client <em>MUST NOT</em>
       proceed with the authorization.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/5.%20%20Mitigation%20Data%20Sent%20to%20the%20Token%20Endpoint"></a></body></html><a class="selflink" href="#section-5" id="section-5">5</a>.  Mitigation Data Sent to the Token Endpoint</span>

   Mitigating the attacks also relies on the client sending additional
   data about the interaction to the token endpoint, for response types
   that use it, and the authorization server checking that data.  The
   mitigation data sent is the same state value that is sent in the
   authorization request and returned in the authorization response.
   This specification defines the new "state" token request parameter
   for passing this additional information.

   As of the time of this writing, these are the existing response types
   that are registered in the IANA "OAuth Authorization Endpoint
   Response Types" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>] that use the token
   endpoint: "code", "code id_token", "code id_token token", and
   "code token".  The state value is to be sent in the "state" token
   request parameter when using these response types, and any new
   response types registered that use the token endpoint.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/5.1.%20%20Example%20Token%20Request"></a></body></html><a class="selflink" href="#section-5.1" id="section-5.1">5.1</a>.  Example Token Request</span>

   The following example token request is part of a protocol interaction
   that used the "code" response type.  It uses the "state" request
   parameter to send mitigation information to the authorization server.














<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   The example of token request follows (with line breaks within lines
   for display purposes only):

     POST /token HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded
     Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

     grant_type=authorization_code
       &amp;code=SplxlOBeZQQYbYS6WxSbIA
       &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb
       &amp;state=ZSGXNBavNc-B3kU3DeJnZoWWOzYxsbvj7jp-S0x_z8U

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.%20%20Validating%20the%20Token%20Request"></a></body></html><a class="selflink" href="#section-6" id="section-6">6</a>.  Validating the Token Request</span>

   When the authorization server receives a token request at the token
   endpoint that contains a value in the "state" parameter, it <em>MUST</em>
   validate that the state value received exactly matches the state
   value previously received in the corresponding authorization request.
   If the recorded state value and the state value received do not
   exactly match, the authorization server <em>MUST NOT</em> proceed with the
   authorization.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.%20%20Security%20Considerations"></a></body></html><a class="selflink" href="#section-7" id="section-7">7</a>.  Security Considerations</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.1.%20%20IdP%20Mix-Up%20and%20Malicious%20Endpoint%20Attacks"></a></body></html><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  IdP Mix-Up and Malicious Endpoint Attacks</span>

   The attacks mitigated by this extension are described in detail in "A
   Comprehensive Formal Security Analysis of OAuth 2.0"
   [<a href="#ref-arXiv.1601.01229v2">arXiv.1601.01229v2</a>] and "On the security of modern Single Sign-On
   Protocols: Second-Order Vulnerabilities in OpenID Connect"
   [<a href="#ref-arXiv.1508.04324v2">arXiv.1508.04324v2</a>].  To mitigate these attacks, clients configured
   to use more than one authorization server should use authorization
   servers that return issuer and client ID information and should
   validate that a consistent set of authorization server endpoints are
   being used when using response types that utilize multiple endpoints.

   When registering, clients <em>SHOULD NOT</em> allow multiple authorization
   servers to return the same issuer value, and <em>MUST NOT</em> allow multiple
   authorization servers to return the same issuer and client ID value
   pair.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.2.%20%20Duplicate%20Information%20Attacks"></a></body></html><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Duplicate Information Attacks</span>

   If a protocol is defined to return the same information in multiple
   locations, this can create an additional attack surface.  Knowing
   that the information is supposed to be the same, recipients will
   often be lazy and use the information from only one of the locations,



<span class="grey">Jones, et al.            Expires January 7, 2017                [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   not validating that all the supposedly duplicate instances are the
   same.  This can enable attackers to create illegal protocol messages
   that have different values in the multiple locations and those
   illegal messages will not be detected or rejected by these lazy
   recipients.

   For this reason, if an OAuth profile is being used that returns the
   mitigation information defined by this specification in one location,
   it <em>SHOULD NOT</em> also be returned in another.  In particular, if a JWT
   containing the client ID and issuer values is being returned in the
   authorization response, they <em>SHOULD NOT</em> also be returned as
   individual authorization response parameters.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.3.%20%20Cut-and-Paste%20Attacks"></a></body></html><a class="selflink" href="#section-7.3" id="section-7.3">7.3</a>.  Cut-and-Paste Attacks</span>

   OAuth authorization responses are sent as redirects to redirection
   URIs, with the response parameters typically passed as URI query
   parameters or fragment values.  A "cut-and-paste" attack is performed
   by the attacker creating what appears to be a legitimate
   authorization response, but that substitutes some of the response
   parameter values with values of the attacker's choosing.  Sometimes
   this is done by copying or "cutting" some values out of a legitimate
   response and replacing or "pasting" some of these values into a
   different response, the original version of which may have also been
   legitimate, creating a combination of response values that are not
   legitimate and that may cause behaviors sought by the attacker.  The
   Code Substitution threat described in <a href="/doc/html/rfc6819#section-4.4.1.13">Section 4.4.1.13 of [RFC6819]</a>
   is one example of the use of a cut-and-paste attack.

   A concern with returning the mitigation information as new individual
   authorization response parameters whose values are not
   cryptographically bound together is that cut-and-paste attacks
   against their values will not be detected.  A security analysis has
   not been done of the effects of the new attacks that the use of cut-
   and-paste against these new values will enable.

   To prevent replay of the state in another browser instance by an
   attacker, the state value <em>MUST</em> be tied to the browser instance in a
   way that cannot be forged by an attacker.  Section 4 of
   [<a href="#ref-I-D.bradley-oauth-jwt-encoded-state">I-D.bradley-oauth-jwt-encoded-state</a>] provides several examples of
   how a client can accomplish this.

   In the replay attack, the attacker can set cookies in the browser.
   Using an unsigned cookie to bind state to the browser is not
   sufficient.






<span class="grey">Jones, et al.            Expires January 7, 2017               [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.%20%20IANA%20Considerations"></a></body></html><a class="selflink" href="#section-8" id="section-8">8</a>.  IANA Considerations</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.1.%20%20OAuth%20Parameters%20Registration"></a></body></html><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  OAuth Parameters Registration</span>

   This specification registers the following parameters in the IANA
   "OAuth Parameters" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>] established by
   <a href="/doc/html/rfc6749">RFC 6749</a> [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>].

<span class="h4"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.1.1.%20%20Registry%20Contents"></a></body></html><a class="selflink" href="#section-8.1.1" id="section-8.1.1">8.1.1</a>.  Registry Contents</span>

   o  Parameter name: "client_id"
   o  Parameter usage location: Authorization Response
   o  Change controller: IESG
   o  Specification document(s): <a href="#section-3.1">Section 3.1</a> of [[ this specification ]]
   o  Related information: None

   o  Parameter name: "iss"
   o  Parameter usage location: Authorization Response
   o  Change controller: IESG
   o  Specification document(s): <a href="#section-3.1">Section 3.1</a> of [[ this specification ]]
   o  Related information: None

   o  Parameter name: "state"
   o  Parameter usage location: Token Request
   o  Change controller: IESG
   o  Specification document(s): <a href="#section-5">Section 5</a> of [[ this specification ]]
   o  Related information: None

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/9.%20%20References"></a></body></html><a class="selflink" href="#section-9" id="section-9">9</a>.  References</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/9.1.%20%20Normative%20References"></a></body></html><a class="selflink" href="#section-9.1" id="section-9.1">9.1</a>.  Normative References</span>

   [<a id="ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>]
              IANA, "OAuth Parameters",
              &lt;<a href="http://www.iana.org/assignments/oauth-parameters">http://www.iana.org/assignments/oauth-parameters</a>&gt;.

   [<a id="ref-JWT">JWT</a>]      Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", <a href="/doc/html/rfc7519">RFC 7519</a>, DOI 10.17487/RFC7519, May 2015,
              &lt;<a href="http://tools.ietf.org/html/rfc7519">http://tools.ietf.org/html/rfc7519</a>&gt;.

   [<a id="ref-OAuth.Discovery">OAuth.Discovery</a>]
              Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Discovery", <a href="/doc/html/draft-ietf-oauth-discovery-02">draft-ietf-oauth-discovery-02</a> (work in
              progress), March 2016, &lt;<a href="http://tools.ietf.org/html/draft-ietf-oauth-discovery-02">http://tools.ietf.org/html/</a>
              <a href="http://tools.ietf.org/html/draft-ietf-oauth-discovery-02">draft-ietf-oauth-discovery-02</a>&gt;.






<span class="grey">Jones, et al.            Expires January 7, 2017               [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   [<a id="ref-OAuth.Responses">OAuth.Responses</a>]
              de Medeiros, B., Ed., Scurtescu, M., Tarjan, P., and M.
              Jones, "OAuth 2.0 Multiple Response Type Encoding
              Practices", February 2014, &lt;<a href="http://openid.net/specs/oauth-v2-multiple-response-types-1_0.html">http://openid.net/specs/</a>
              <a href="http://openid.net/specs/oauth-v2-multiple-response-types-1_0.html">oauth-v2-multiple-response-types-1_0.html</a>&gt;.

   [<a id="ref-OpenID.Core">OpenID.Core</a>]
              Sakimura, N., Bradley, J., Jones, M., de Medeiros, B., and
              C. Mortimore, "OpenID Connect Core 1.0", November 2014,
              &lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC3629">RFC3629</a>]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", STD 63, <a href="/doc/html/rfc3629">RFC 3629</a>, DOI 10.17487/RFC3629, November
              2003, &lt;<a href="http://www.rfc-editor.org/info/rfc3629">http://www.rfc-editor.org/info/rfc3629</a>&gt;.

   [<a id="ref-RFC5785">RFC5785</a>]  Nottingham, M. and E. Hammer-Lahav, "Defining Well-Known
              Uniform Resource Identifiers (URIs)", <a href="/doc/html/rfc5785">RFC 5785</a>,
              DOI 10.17487/RFC5785, April 2010,
              &lt;<a href="http://www.rfc-editor.org/info/rfc5785">http://www.rfc-editor.org/info/rfc5785</a>&gt;.

   [<a id="ref-RFC6749">RFC6749</a>]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              <a href="/doc/html/rfc6749">RFC 6749</a>, DOI 10.17487/RFC6749, October 2012,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6749">http://www.rfc-editor.org/info/rfc6749</a>&gt;.

   [<a id="ref-RFC6819">RFC6819</a>]  Lodderstedt, T., Ed., McGloin, M., and P. Hunt, "OAuth 2.0
              Threat Model and Security Considerations", <a href="/doc/html/rfc6819">RFC 6819</a>,
              DOI 10.17487/RFC6819, January 2013,
              &lt;<a href="http://www.rfc-editor.org/info/rfc6819">http://www.rfc-editor.org/info/rfc6819</a>&gt;.

   [<a id="ref-RFC7159">RFC7159</a>]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", <a href="/doc/html/rfc7159">RFC 7159</a>, DOI 10.17487/RFC7159, March
              2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7159">http://www.rfc-editor.org/info/rfc7159</a>&gt;.

   [<a id="ref-RFC7662">RFC7662</a>]  Richer, J., Ed., "OAuth 2.0 Token Introspection",
              <a href="/doc/html/rfc7662">RFC 7662</a>, DOI 10.17487/RFC7662, October 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7662">http://www.rfc-editor.org/info/rfc7662</a>&gt;.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/9.2.%20%20Informative%20References"></a></body></html><a class="selflink" href="#section-9.2" id="section-9.2">9.2</a>.  Informative References</span>








<span class="grey">Jones, et al.            Expires January 7, 2017               [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


   [<a id="ref-arXiv.1508.04324v2">arXiv.1508.04324v2</a>]
              Mladenov, V., Mainka, C., and J. Schwenk, "On the security
              of modern Single Sign-On Protocols: Second-Order
              Vulnerabilities in OpenID Connect", arXiv 1508.04324v2,
              January 2016, &lt;<a href="http://arxiv.org/abs/1508.04324v2/">http://arxiv.org/abs/1508.04324v2/</a>&gt;.

   [<a id="ref-arXiv.1601.01229v2">arXiv.1601.01229v2</a>]
              Fett, D., Kuesters, R., and G. Schmitz, "A Comprehensive
              Formal Security Analysis of OAuth 2.0",
              arXiv 1601.01229v2, January 2016,
              &lt;<a href="http://arxiv.org/abs/1601.01229v2/">http://arxiv.org/abs/1601.01229v2/</a>&gt;.

   [<a id="ref-I-D.bradley-oauth-jwt-encoded-state">I-D.bradley-oauth-jwt-encoded-state</a>]
              Bradley, J., Lodderstedt, T., and H. Zandbelt, "Encoding
              claims in the OAuth 2 state parameter using a JWT", <a href="/doc/html/draft-bradley-oauth-jwt-encoded-state-05">draft-</a>
              <a href="/doc/html/draft-bradley-oauth-jwt-encoded-state-05">bradley-oauth-jwt-encoded-state-05</a> (work in progress),
              December 2015.

   [<a id="ref-RFC7591">RFC7591</a>]  Richer, J., Ed., Jones, M., Bradley, J., Machulak, M., and
              P. Hunt, "OAuth 2.0 Dynamic Client Registration Protocol",
              <a href="/doc/html/rfc7591">RFC 7591</a>, DOI 10.17487/RFC7591, July 2015,
              &lt;<a href="http://www.rfc-editor.org/info/rfc7591">http://www.rfc-editor.org/info/rfc7591</a>&gt;.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20A.%20%20Implementation%20Notes"></a></body></html><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Implementation Notes</span>

   The authorization server can compare the two state values either by
   recording the complete state value between the authorization request
   and the token request, possibly in the same data structure in which
   the authorization code issued was recorded, or by recording only a
   cryptographic hash of the state value, possibly resulting in
   substantial size savings.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20B.%20%20Acknowledgements"></a></body></html><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  Acknowledgements</span>

   Alfred Albrecht, John Bradley, Brian Campbell, Joerg Connotte,
   William Denniss, Sebastian Ebling, Florian Feldmann, Daniel Fett,
   Roland Hedberg, Phil Hunt, Ralf Kuesters, Torsten Lodderstedt,
   Christian Mainka, Vladislav Mladenov, Anthony Nadalin, Justin Richer,
   Nat Sakimura, Antonio Sanso, Guido Schmitz, Joerg Schwenk, Hannes
   Tschofenig, and Hans Zandbelt all contributed to the discussions that
   led to the creation of this specification.

   This specification is partially based on the OpenID Connect Core 1.0
   specification, which was produced by the OpenID Connect working group
   of the OpenID Foundation.






<span class="grey">Jones, et al.            Expires January 7, 2017               [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey">Internet-Draft         OAuth 2.0 Mix-Up Mitigation             July 2016</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20C.%20%20Open%20Issues"></a></body></html><a class="selflink" href="#appendix-C" id="appendix-C">Appendix C</a>.  Open Issues</span>

   o  We need to do a security analysis of the cut-and-paste attacks
      that may be enabled when mitigation information is returned to the
      client using individual authorization response parameters.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20D.%20%20Document%20History"></a></body></html><a class="selflink" href="#appendix-D" id="appendix-D">Appendix D</a>.  Document History</span>

   [[ to be removed by the RFC Editor before publication as an RFC ]]

   -01

   o  Changed terms "issuer URL" and "configuration information
      location" to "issuer identifier" so that consistent terminology is
      used for this.

   -00

   o  Created the initial working group draft from <a href="/doc/html/draft-jones-oauth-mix-up-mitigation-01">draft-jones-oauth-</a>
      <a href="/doc/html/draft-jones-oauth-mix-up-mitigation-01">mix-up-mitigation-01</a> with no normative changes and adding Nat
      Sakimura as an editor.

Authors' Addresses

   Michael B. Jones
   Microsoft

   Email: mbj@microsoft.com
   URI:   <a href="http://self-issued.info/">http://self-issued.info/</a>


   John Bradley
   Ping Identity

   Email: ve7jtb@ve7jtb.com
   URI:   <a href="http://www.thread-safe.com/">http://www.thread-safe.com/</a>


   Nat Sakimura
   Nomura Research Institute, Ltd.

   Email: n-sakimura@nri.co.jp
   URI:   <a href="http://nat.sakimura.org/">http://nat.sakimura.org/</a>








Jones, et al.            Expires January 7, 2017               [Page 14]
</pre>
</div>
</div>
</div>
<script>$(".visible-nojs").removeClass("visible-nojs");</script>
<script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
<script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>
</body>
</html>
