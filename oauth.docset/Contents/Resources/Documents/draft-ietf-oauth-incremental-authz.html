<!DOCTYPE html>
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html --><html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>
  
    draft-ietf-oauth-incremental-authz-04
  
</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>
<!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.38.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.38.0/respond/dest/respond.min.js"></script>
    <![endif]-->
<link href="/feed/document-changes/draft-ietf-oauth-incremental-authz/" rel="alternate" title="Document changes" type="application/atom+xml"/>
<meta content="OAuth 2.0 Incremental Authorization (Internet-Draft, 2020)" name="description"/>
<script src="https://www.ietf.org/lib/dt/7.38.0/d3/d3.min.js"></script>
<script src="https://www.ietf.org/lib/dt/7.38.0/jquery/jquery.min.js"></script>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/ietf-icon-blue3.png" rel="shortcut icon"/>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/apple-touch-icon.png" rel="apple-touch-icon"/>
</head>
<body style="padding-top: 0;">
<div class="content" id="content">
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
<div class="rfcmarkup">
<div class="noprint" style="height: 6px;">
<div class="meta-info bgred" onclick="showLegend();" onmouseout="hideLegend()" onmouseover="this.style.cursor='pointer';" style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; " title="Click for colour legend.">Â </div>
<div class="meta-info noprint pre legend" id="legend" onmouseout="hideLegend();" onmouseover="showLegend();" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
</div>
</div>
<div class="noprint">
<pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-incremental-authz-04.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-incremental-authz-04.xml" title="XML source for this document">xml</a>|<a href="https://tools.ietf.org/pdf/draft-ietf-oauth-incremental-authz-04.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/draft-ietf-oauth-incremental-authz/04/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/draft-ietf-oauth-incremental-authz/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/oauth/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-oauth-incremental-authz@ietf.org?subject=draft-ietf-oauth-incremental-authz" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=draft-ietf-oauth-incremental-authz-04.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-oauth-incremental-authz-04.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-oauth-incremental-authz-04.txt" title="Run an idnits check of this document">Nits</a>]

Versions: <a href="/doc/html/draft-ietf-oauth-incremental-authz-00">00</a> <a href="/doc/html/draft-ietf-oauth-incremental-authz-01">01</a> <a href="/doc/html/draft-ietf-oauth-incremental-authz-02">02</a> <a href="/doc/html/draft-ietf-oauth-incremental-authz-03">03</a> <a href="/doc/html/draft-ietf-oauth-incremental-authz-04"><b>04</b></a>                                                </pre>
</div>
<div class="draftcontent">
<pre>OAuth Working Group                                           W. Denniss
Internet-Draft                                                    Google
Intended status: Standards Track                             May 3, 2020
Expires: November 4, 2020


                  <span class="h1">OAuth 2.0 Incremental Authorization</span>
                 <span class="h1">draft-ietf-oauth-incremental-authz-04</span>

Abstract

   OAuth 2.0 authorization requests that include every scope the client
   might ever need can result in over-scoped authorization and a sub-
   optimal end-user consent experience.  This specification enhances the
   OAuth 2.0 authorization protocol by adding incremental authorization,
   the ability to request specific authorization scopes as needed, when
   they're needed, removing the requirement to request every possible
   scope that might be needed upfront.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="/doc/html/bcp78">BCP 78</a> and <a href="/doc/html/bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 4, 2020.

Copyright Notice

   Copyright (c) 2020 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in <a href="#section-4">Section 4</a>.e of



<span class="grey">Denniss                 Expires November 4, 2020                [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Notational Conventions  . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-4">4</a>.  Incremental Auth for Confidential Clients . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-5">5</a>.  Incremental Auth for Public Clients . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-6">6</a>.  Usability Considerations  . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-6.1">6.1</a>.  Handling Denials  . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-6.2">6.2</a>.  Handling Scope Reductions . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-7">7</a>.  Alternative Approaches  . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-7.1">7.1</a>.  Alternative for Public Clients  . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-7.2">7.2</a>.  Alternative for Confidential Clients  . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-8">8</a>.  Privacy Considerations  . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-8.1">8.1</a>.  Requesting Authorization In Context . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-8.2">8.2</a>.  Preventing Overbroad Authorization Requests . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-8.3">8.3</a>.  Authorization Correlation . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-8.4">8.4</a>.  Previously Granted Scopes . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-9">9</a>.  Discovery Metadata  . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-10">10</a>. Security Considerations . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-10.1">10.1</a>.  Public Client Impersonation  . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-11">11</a>. IANA Considerations . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-11.1">11.1</a>.  OAuth Parameters Registry  . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-11.2">11.2</a>.  OAuth Extensions Error Registration  . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-11.3">11.3</a>.  OAuth 2.0 Authorization Server Metadata  . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-12">12</a>. Normative References  . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#appendix-A">Appendix A</a>.  Acknowledgements . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   <a href="#appendix-B">Appendix B</a>.  Document History . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.%20%20Introduction"></a></body></html><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   OAuth 2.0 clients may offer multiple features that require user
   authorization, but commonly not every user will use each feature.
   Without incremental authentication, applications need to either
   request all the possible scopes they need upfront, potentially
   resulting in a bad user experience, or track each authorization grant
   separately, complicating development.

   The goal of incremental authorization is to allow clients to request
   just the scopes they need, when they need them, while allowing them
   to store a single authorization grant for the user that contains the
   sum of the scopes granted.  Thus, each new authorization request
   increments the scope of the authorization grant, without the client




<span class="grey">Denniss                 Expires November 4, 2020                [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   needing to track a separate authorization grant for each group of
   scopes.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.%20%20Notational%20Conventions"></a></body></html><a class="selflink" href="#section-2" id="section-2">2</a>.  Notational Conventions</span>

   The key words "<em>MUST</em>", "<em>MUST NOT</em>", "<em>REQUIRED</em>", "<em>SHALL</em>", "<em>SHALL NOT</em>",
   "<em>SHOULD</em>", "<em>SHOULD NOT</em>", "<em>RECOMMENDED</em>", "NOT <em>RECOMMENDED</em>", "<em>MAY</em>", and
   "<em>OPTIONAL</em>" in this document are to be interpreted as described in Key
   words for use in RFCs to Indicate Requirement Levels [<a href="/doc/html/rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>].  If
   these words are used without being spelled in uppercase then they are
   to be interpreted with their normal natural language meanings.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.%20%20Terminology"></a></body></html><a class="selflink" href="#section-3" id="section-3">3</a>.  Terminology</span>

   In addition to the terms defined in referenced specifications, this
   document uses the following terms:

   "OAuth"  In this document, OAuth refers to OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>].

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.%20%20Incremental%20Auth%20for%20Confidential%20Clients"></a></body></html><a class="selflink" href="#section-4" id="section-4">4</a>.  Incremental Auth for Confidential Clients</span>

   For confidential clients, such as web servers that can keep secrets,
   the authorization endpoint <em>SHOULD</em> treat scopes that the user already
   granted differently on the consent user interface.  Typically such
   scopes are hidden for new authorization requests, or at least there
   is an indication that the user already approved them.

   By itself, this property of the authorization endpoint enables
   incremental authorization.  The client can track every scope they've
   ever requested, and include those scopes on every new authorization
   request.

   To avoid the need for confidential clients to re-request already
   authorized scopes, authorization servers <em>MAY</em> support an additional
   "include_granted_scopes" parameter in the authorization request.
   This parameter, enables the client to request tokens during the
   authorization grant exchange that represent the full scope of the
   user's grant to the application including any previous grants,
   without the client needing to track the scopes directly.

   The client indicates they wish the new authorization grant to include
   previously granted scopes by sending the following additional
   parameter in the OAuth 2.0 Authorization Request (<a href="/doc/html/rfc6749#section-4.1.1">SectionÂ 4.1.1 of
   [RFC6749]</a>.) using the following additional parameter:

   include_granted_scopes  <em>OPTIONAL</em>.  Either "true" or "false".  When
      "true", the authorization server <em>SHOULD</em> include previously granted
      scopes for this client in the new authorization grant.



<span class="grey">Denniss                 Expires November 4, 2020                [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/5.%20%20Incremental%20Auth%20for%20Public%20Clients"></a></body></html><a class="selflink" href="#section-5" id="section-5">5</a>.  Incremental Auth for Public Clients</span>

   Unlike with confidential clients, it is NOT RECOMMEND to
   automatically approve OAuth requests for public clients without user
   consent (see <a href="#section-10.2">Section 10.2</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>], and <a href="#section-8.6">Section 8.6</a> of
   OAuth 2.0 [<a href="/doc/html/rfc8252" title='"OAuth 2.0 for Native Apps"'>RFC8252</a>]), thus authorization grants shouldn't contain
   previously authorized scopes in the manner described above for
   confidential clients.

   Public clients (and confidential clients using this technique) should
   instead track the scopes for every authorization grant, and only
   request yet to be granted scopes during incremental authorization.
   In the past, this would result in multiple discrete authorization
   grants that would need to be tracked.  To enable incrementing a
   single authorization grant for public clients, the client supplies
   their existing refresh token during the authorization code exchange,
   and receives new authorization tokens with the scope of the previous
   and current authorization grants.

   The client sends the previous refresh token in the OAuth 2.0 Access
   Token Request (<a href="/doc/html/rfc6749#section-4.1.3">SectionÂ 4.1.3 of [RFC6749]</a>.) using the following
   additional parameter:

   existing_grant  <em>OPTIONAL</em>.  The refresh token from the existing
      authorization grant.

   When processing the token exchange, in addition to the normal
   processing of such a request, the token endpoint <em>MUST</em> verify that
   token provided in the "existing_grant" parameter is unexpired and
   unrevoked, and was issued to the same client id and relates to the
   same user as the current authorization grant.  If this verification
   succeeds, the new access and refresh tokens issued in the Access
   Token Response (<a href="#section-4.1.4">Section 4.1.4</a> of ) <em>MUST</em> include authorization for the
   scopes in the previous grant, unless the authorization server is
   exercising its prerogative to "fully or partially ignore the scope
   requested by the client" per <a href="#section-3.3">Section 3.3</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>].

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.%20%20Usability%20Considerations"></a></body></html><a class="selflink" href="#section-6" id="section-6">6</a>.  Usability Considerations</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.1.%20%20Handling%20Denials"></a></body></html><a class="selflink" href="#section-6.1" id="section-6.1">6.1</a>.  Handling Denials</span>

   A core principle of OAuth is that users may deny authorization
   requests for any reason.  This remains true for incremental
   authorization requests.  In the case of incremental authorization,
   clients may already have a valid authorization and receive a denial
   for an incremental authorization request (that is, an "access_denied"
   error code as defined in <a href="#section-4.1.2.1">Section 4.1.2.1</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>]).
   Clients should <em>SHOULD</em> handle such errors gracefully and not discard



<span class="grey">Denniss                 Expires November 4, 2020                [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   any existing authorization grants if the user denies an incremental
   authorization request.  Clients <em>SHOULD NOT</em> immediately request the
   same incremental authorization again, as this may result in an
   infinite denial loop (and the end-user feeling badgered).

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.2.%20%20Handling%20Scope%20Reductions"></a></body></html><a class="selflink" href="#section-6.2" id="section-6.2">6.2</a>.  Handling Scope Reductions</span>

   As specified by <a href="#section-5.1">Section 5.1</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>], a successful
   response may not always include all the scope that was asked for, a
   fact indicated by the "scope" response parameter when it happens.
   This is still true in the case of incremental auth.  The success
   response may include less scope than what was requested, or even less
   scope than before the incremental authorization request (say, if the
   user was given an opportunity to revise the grant down).  Clients
   <em>MUST</em> check for the "scope" parameter in success responses and react
   accordingly.

   For the purposes of an incremental auth request, a success response
   to an incremental authorization request that contains the same scope
   granted prior to the request being made, and an error response (for
   example, in the case of a denial) can have the same effect: the
   client retains a grant with the same scope as before.  In the case of
   the approved request but with the same scope, they have a new grant,
   but with the same scope.  In the case of the denied incremental
   authorization request, they still have the old grant with the same
   scope (although in some cases it may have been revoked or reduced in
   scope out of band).

   An incremental authorization request isn't the only time that scope
   can be reduced for a grant.  As specified by <a href="#section-6">section 6</a> of OAuth 2.0
   [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>], scope can be reduced during a token refresh as well.  So
   it's a good practice for clients to retain the current scope of the
   grant, update it during authorization, incremental authorization and
   token refreshes, and take action at any time based on the current
   scope by presenting an incremental authorization if a non-present
   scope is needed.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.%20%20Alternative%20Approaches"></a></body></html><a class="selflink" href="#section-7" id="section-7">7</a>.  Alternative Approaches</span>

   This non-normative section discusses some alternative ways to achieve
   the incremental authorization result purely on the client side.
   These options are somewhat more complex and burdensome to client
   developers.








<span class="grey">Denniss                 Expires November 4, 2020                [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.1.%20%20Alternative%20for%20Public%20Clients"></a></body></html><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Alternative for Public Clients</span>

   It is possible for OAuth clients to maintain multiple authorizations
   per user for feature-specific scopes without needing the feature
   documented in this specification.  For example, a public client (such
   as a mobile app) could maintain an authorization for the contacts and
   one for calendar, and store them separately.

   This specification offers a convenience that a single authorization
   grant can be managed that represents all the scope granted so far,
   rather than needing to maintain multiple, however it does require
   that all grants are made from a single end-user account (as
   authorization servers cannot typically combine grants from multiple
   users).  Clients where users may wish to authorize separate end-user
   accounts for different features should consider using the alternative
   documented in this section.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.2.%20%20Alternative%20for%20Confidential%20Clients"></a></body></html><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Alternative for Confidential Clients</span>

   An alternative incremental auth design for confidential clients is to
   ask for authorization scopes as they are needed and keep a running
   record of all granted scopes.  In this way each incremental
   authorization request would include all scopes granted so far, plus
   the new scope needed.  Authorization servers can see the existing
   scopes and only display the new scopes for approval (and likely to
   inform the user of the existing grants).  This approach can be
   performed using <a href="/doc/html/rfc6749">RFC 6749</a> without additions, but requires the client
   to keep track of every authorization grant.

   Confidential clients can also use the alternative documented for
   public clients in <a href="#section-7.1">Section 7.1</a>.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.%20%20Privacy%20Considerations"></a></body></html><a class="selflink" href="#section-8" id="section-8">8</a>.  Privacy Considerations</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.1.%20%20Requesting%20Authorization%20In%20Context"></a></body></html><a class="selflink" href="#section-8.1" id="section-8.1">8.1</a>.  Requesting Authorization In Context</span>

   The goal of incremental authorization is to enhance end-user privacy
   by allowing clients to request only the authorization scopes needed
   in the context of a particular user action, rather than asking for
   ever possible scope upfront.  For example, an app may offer calendar
   and contacts integration, and an extension of OAuth like OpenID
   Connect for sign-in.  Such an app should first sign the user in with
   just the scopes needed for that.  If later the user interacts with
   the calendar or contacts features then, and only then, should the
   requires scopes be requested.  By using this specification, apps can
   improve the privacy choices of end-users by only requesting the
   scopes they need in context.




<span class="grey">Denniss                 Expires November 4, 2020                [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   Clients authorizing the user with an authorization server that
   supports incremental auth <em>SHOULD</em> ask for the minimal authorization
   scope for the user's current context, and use this specification to
   add authorization scope as required.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.2.%20%20Preventing%20Overbroad%20Authorization%20Requests"></a></body></html><a class="selflink" href="#section-8.2" id="section-8.2">8.2</a>.  Preventing Overbroad Authorization Requests</span>

   When this specification is implemented, clients should have no
   technical reason to make overbroad authorization requests (i.e.
   requesting every possible scope they might ever expect need, rather
   than ones related to the user's current activity).  To improve
   privacy, it is therefore <em>RECOMMENDED</em> for authorization servers to
   limit the authorization scope that can be requested in a single
   authorization to what would reasonably be needed by a single feature.
   The authorization server <em>MAY</em> deny such authorization requests with
   the following error code.

   overbroad_scope
      The scope of the request is considered overbroad by the
      authorization server.  Consult the documentation of your
      authorization server to determine acceptable scope combinations,
      and consider using [[ This Specification ]] to perform incremental
      authorization requests in the context that the scope is needed.

   Determining what constitutes an overbroad request is the purview of
   the authorization server.  As an example, say an authorization
   supported "calendar" and "mail" scopes to access a user's calendar
   and inbox respectively.  They may decide that their users should have
   the chance to grant such requests in context through incremental
   authorization, rather then all at once upfront, and deny the request
   for being overly broad.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.3.%20%20Authorization%20Correlation"></a></body></html><a class="selflink" href="#section-8.3" id="section-8.3">8.3</a>.  Authorization Correlation</span>

   Incremental authorization is designed for use-cases where it's the
   same user authorizing each request, and thus all incremental
   authorization grants are correlated to that one user (by being merged
   into a single authorization grant).  For applications where users may
   wish to connect different user accounts for different features (e.g.
   contacts from one account, and calendar from another) it is
   <em>RECOMMENDED</em> to instead allow multiple unrelated authorizations, as
   documented in <a href="#section-7.1">Section 7.1</a>.

   The goal of this specification is to improve end-user privacy by
   giving them more choice over which scopes they grant access to.
   Previously many apps would request an overly large number of scopes
   upfront (typically for all the features of the app, rather than the
   subset that the user is currently wishing to use).  The scopes in



<span class="grey">Denniss                 Expires November 4, 2020                [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   such authorization grants are necessarily correlated with the same
   user as they are contained in a single authorization grant.
   Implementing this specification doesn't change that attribute, but it
   does improve user privacy overall by empowering the user to grant
   access in a more granular way.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/8.4.%20%20Previously%20Granted%20Scopes"></a></body></html><a class="selflink" href="#section-8.4" id="section-8.4">8.4</a>.  Previously Granted Scopes</span>

   When the authorization server displays the list of scopes on page and
   prompts the user to consent to sharing access, users may assume that
   the displayed list of scopes on such a page is the full and complete
   list being granted to the application.  It may be desirable for such
   a consent page to list previously granted scopes, provided that the
   client is confidential, or one that cannot be impersonated.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/9.%20%20Discovery%20Metadata"></a></body></html><a class="selflink" href="#section-9" id="section-9">9</a>.  Discovery Metadata</span>

   Support for the incremental authorization <em>MAY</em> be declared in the
   OAuth 2.0 Authorization Server Metadata [<a href="/doc/html/rfc8414" title='"OAuth 2.0 Authorization Server Metadata"'>RFC8414</a>] with the following
   metadata:

   incremental_authz_types_supported
      <em>OPTIONAL</em>.  JSON array of OAuth 2.0 client types that are supported
      for incremental authorization.  The possible types are
      "confidential", and "public".

   Specifically, "confidential" indicates that the behavior documented
   in <a href="#section-4">Section 4</a> (Incremental Auth for Confidential Clients) is
   supported, and "public" indicates that the behavior documented in
   <a href="#section-5">Section 5</a> (Incremental Auth for Public Clients) is supported.

   A server which supports both forms of incremental auth documented in
   this specification would declare support like so:

     "incremental_authz_types_supported": ["confidential", "public"]

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/10.%20%20Security%20Considerations"></a></body></html><a class="selflink" href="#section-10" id="section-10">10</a>.  Security Considerations</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/10.1.%20%20Public%20Client%20Impersonation"></a></body></html><a class="selflink" href="#section-10.1" id="section-10.1">10.1</a>.  Public Client Impersonation</span>

   As documented in <a href="/doc/html/rfc8252#section-8.6">SectionÂ 8.6 of RFC 8252</a> [<a href="/doc/html/rfc8252" title='"OAuth 2.0 for Native Apps"'>RFC8252</a>], some public
   clients are susceptible to client impersonation, depending on the
   type of redirect URI used.  If the "include_granted_scopes" feature
   documented in <a href="#section-4">Section 4</a> is used by an impersonating client, it may
   receive a greater authorization grant than the user specifically
   approved for that client.  For this reason, the
   "include_granted_scopes" feature <em>MUST NOT</em> be enabled for such public
   client requests.



<span class="grey">Denniss                 Expires November 4, 2020                [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   Note that there is no such restriction on the use of "existing_grant"
   feature documented in <a href="#section-5">Section 5</a>.  While it is designed for public
   clients, it <em>MAY</em> be supported for all client types.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/11.%20%20IANA%20Considerations"></a></body></html><a class="selflink" href="#section-11" id="section-11">11</a>.  IANA Considerations</span>

   This specification makes a registration request as follows:

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/11.1.%20%20OAuth%20Parameters%20Registry"></a></body></html><a class="selflink" href="#section-11.1" id="section-11.1">11.1</a>.  OAuth Parameters Registry</span>

   This specification registers the following parameters in the IANA
   OAuth Parameters registry defined in OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>].

   o  Parameter name: include_granted_scopes

   o  Parameter usage location: authorization request

   o  Change controller: IESG

   o  Specification document(s): this document

   o  Parameter name: existing_grant

   o  Parameter usage location: token request

   o  Change controller: IESG

   o  Specification document(s): this document

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/11.2.%20%20OAuth%20Extensions%20Error%20Registration"></a></body></html><a class="selflink" href="#section-11.2" id="section-11.2">11.2</a>.  OAuth Extensions Error Registration</span>

   This specification registers the following values in the IANA "OAuth
   Extensions Error Registry" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>]
   established by [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>].

      Name: overbroad_scope
      Usage Location: authorization code grant error response
      Protocol Extension: [[ This Specification ]]
      Change Controller: IETF
      Reference: <a href="#section-8.2">Section 8.2</a> of [[ This Specification ]]

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/11.3.%20%20OAuth%202.0%20Authorization%20Server%20Metadata"></a></body></html><a class="selflink" href="#section-11.3" id="section-11.3">11.3</a>.  OAuth 2.0 Authorization Server Metadata</span>

   This specification registers the following values in the IANA "OAuth
   2.0 Authorization Server Metadata" registry [<a href="#ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>]
   established by [<a href="/doc/html/rfc8414" title='"OAuth 2.0 Authorization Server Metadata"'>RFC8414</a>].

   o  Metadata Name: incremental_authz_types_supported



<span class="grey">Denniss                 Expires November 4, 2020                [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   o  Metadata Description: JSON array containing a list of client types
      that support OAuth 2.0 Incremental Authorization [[ this
      specification ]].  The possible types are "confidential", and
      "public".
   o  Change controller: IESG
   o  Specification Document: <a href="#section-9">Section 9</a> of [[ this specification ]]

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/12.%20%20Normative%20References"></a></body></html><a class="selflink" href="#section-12" id="section-12">12</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC6749">RFC6749</a>]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              <a href="/doc/html/rfc6749">RFC 6749</a>, DOI 10.17487/RFC6749, October 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;.

   [<a id="ref-RFC8252">RFC8252</a>]  Denniss, W. and J. Bradley, "OAuth 2.0 for Native Apps",
              <a href="/doc/html/bcp212">BCP 212</a>, <a href="/doc/html/rfc8252">RFC 8252</a>, DOI 10.17487/RFC8252, October 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8252">https://www.rfc-editor.org/info/rfc8252</a>&gt;.

   [<a id="ref-RFC8414">RFC8414</a>]  Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Authorization Server Metadata", <a href="/doc/html/rfc8414">RFC 8414</a>,
              DOI 10.17487/RFC8414, June 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8414">https://www.rfc-editor.org/info/rfc8414</a>&gt;.

   [<a id="ref-IANA.OAuth.Parameters">IANA.OAuth.Parameters</a>]
              IANA, "OAuth Parameters",
              &lt;<a href="http://www.iana.org/assignments/oauth-parameters">http://www.iana.org/assignments/oauth-parameters</a>&gt;.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20A.%20%20Acknowledgements"></a></body></html><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Acknowledgements</span>

   This document was produced in the OAuth working group under the
   chairpersonship of Rifaat Shekh-Yusef and Hannes Tschofenig with
   Benjamin Kaduk, and Eric Rescorla serving as Security Area Directors.

   The following individuals contributed ideas, feedback, and wording
   that shaped and formed the final specification:

   Yanna Wu, Marius Scurtescu, Jason Huang, Nicholas Watson, Breno de
   Medeiros, Naveen Agarwal, Brian Campbell, and Aaron Parecki.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20B.%20%20Document%20History"></a></body></html><a class="selflink" href="#appendix-B" id="appendix-B">Appendix B</a>.  Document History</span>

   [[ to be removed by the RFC Editor before publication as an RFC ]]

   01



<span class="grey">Denniss                 Expires November 4, 2020               [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey">Internet-Draft     OAuth 2.0 Incremental Authorization          May 2020</span>


   o  Changed a <em>SHOULD</em> to a <em>MUST</em> in <a href="#section-5">Section 5</a> regarding the protocol
      behavior of incremental auth for public clients, while clarifying
      that the authorization server retains the prerogative to do
      whatever it wants.

   o  Defined an OAuth Metadata entry.

   00

   o  Now a working group draft.

   <a href="/doc/html/draft-wdenniss-oauth-incremental-auth-01">draft-wdenniss-oauth-incremental-auth-01</a>

   o  Added usability, privacy, and security considerations.

   o  Documented alternative approaches.

   <a href="/doc/html/draft-wdenniss-oauth-incremental-auth-00">draft-wdenniss-oauth-incremental-auth-00</a>

   o  Initial draft based on the implementation of incremental and
      "appcremental" auth at Google.

Author's Address

   William Denniss
   Google
   1600 Amphitheatre Pkwy
   Mountain View, CA  94043
   USA

   Email: wdenniss@google.com
   URI:   <a href="https://wdenniss.com/incremental-auth">https://wdenniss.com/incremental-auth</a>



















Denniss                 Expires November 4, 2020               [Page 11]
</pre>
</div>
</div>
</div>
<script>$(".visible-nojs").removeClass("visible-nojs");</script>
<script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
<script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>
</body>
</html>
