<!DOCTYPE html>
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html --><html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>
  
    draft-ietf-oauth-jwt-bcp-07
  
</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>
<!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.38.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.38.0/respond/dest/respond.min.js"></script>
    <![endif]-->
<link href="/feed/document-changes/draft-ietf-oauth-jwt-bcp/" rel="alternate" title="Document changes" type="application/atom+xml"/>
<meta content="JSON Web Token Best Current Practices (Internet-Draft, 2019)" name="description"/>
<script src="https://www.ietf.org/lib/dt/7.38.0/d3/d3.min.js"></script>
<script src="https://www.ietf.org/lib/dt/7.38.0/jquery/jquery.min.js"></script>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/ietf-icon-blue3.png" rel="shortcut icon"/>
<link href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/apple-touch-icon.png" rel="apple-touch-icon"/>
</head>
<body style="padding-top: 0;">
<div class="content" id="content">
<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
<div class="rfcmarkup">
<div class="noprint" style="height: 6px;">
<div class="meta-info bgred" onclick="showLegend();" onmouseout="hideLegend()" onmouseover="this.style.cursor='pointer';" style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; " title="Click for colour legend."> </div>
<div class="meta-info noprint pre legend" id="legend" onmouseout="hideLegend();" onmouseover="showLegend();" style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; ">
</div>
</div>
<div class="noprint">
<pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-jwt-bcp-07.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-jwt-bcp-07.xml" title="XML source for this document">xml</a>|<a href="https://tools.ietf.org/pdf/draft-ietf-oauth-jwt-bcp-07.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/draft-ietf-oauth-jwt-bcp/07/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/draft-ietf-oauth-jwt-bcp/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/oauth/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-oauth-jwt-bcp@ietf.org?subject=draft-ietf-oauth-jwt-bcp" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&amp;url2=draft-ietf-oauth-jwt-bcp-07.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-oauth-jwt-bcp-07.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-oauth-jwt-bcp-07.txt" title="Run an idnits check of this document">Nits</a>]

Versions: (<a href="/doc/html/draft-sheffer-oauth-jwt-bcp">draft-sheffer-oauth-jwt-bcp</a>) <a href="/doc/html/draft-ietf-oauth-jwt-bcp-00">00</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-01">01</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-02">02</a>   Best Current Practice
          <a href="/doc/html/draft-ietf-oauth-jwt-bcp-03">03</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-04">04</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-05">05</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-06">06</a> <a href="/doc/html/draft-ietf-oauth-jwt-bcp-07"><b>07</b></a> <a href="/doc/html/rfc8725">rfc8725</a>                                        </pre>
</div>
<div class="draftcontent">
<pre>OAuth Working Group                                           Y. Sheffer
Internet-Draft                                                    Intuit
Updates: RFC <a href="/doc/html/rfc7519">7519</a> (if approved)                                 D. Hardt
Intended status: Best Current Practice
Expires: April 15, 2020                                         M. Jones
                                                               Microsoft
                                                        October 13, 2019


                 <span class="h1">JSON Web Token Best Current Practices</span>
                      <span class="h1">draft-ietf-oauth-jwt-bcp-07</span>

Abstract

   JSON Web Tokens, also known as JWTs, are URL-safe JSON-based security
   tokens that contain a set of claims that can be signed and/or
   encrypted.  JWTs are being widely used and deployed as a simple
   security token format in numerous protocols and applications, both in
   the area of digital identity, and in other application areas.  The
   goal of this Best Current Practices document is to provide actionable
   guidance leading to secure implementation and deployment of JWTs.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="/doc/html/bcp78">BCP 78</a> and <a href="/doc/html/bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on April 15, 2020.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents



<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 1]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-2"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-1.1">1.1</a>.  Target Audience . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-1.2">1.2</a>.  Conventions used in this document . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-2">2</a>.  Threats and Vulnerabilities . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-2.1">2.1</a>.  Weak Signatures and Insufficient Signature Validation . .   <a href="#page-4">4</a>
     <a href="#section-2.2">2.2</a>.  Weak Symmetric Keys . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-2.3">2.3</a>.  Incorrect Composition of Encryption and Signature . . . .   <a href="#page-5">5</a>
     2.4.  Plaintext Leakage through Analysis of Ciphertext Length .   5
     <a href="#section-2.5">2.5</a>.  Insecure Use of Elliptic Curve Encryption . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-2.6">2.6</a>.  Multiplicity of JSON Encodings  . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-2.7">2.7</a>.  Substitution Attacks  . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-2.8">2.8</a>.  Cross-JWT Confusion . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-2.9">2.9</a>.  Indirect Attacks on the Server  . . . . . . . . . . . . .   <a href="#page-6">6</a>
   <a href="#section-3">3</a>.  Best Practices  . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-3.1">3.1</a>.  Perform Algorithm Verification  . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-3.2">3.2</a>.  Use Appropriate Algorithms  . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-3.3">3.3</a>.  Validate All Cryptographic Operations . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-3.4">3.4</a>.  Validate Cryptographic Inputs . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-3.5">3.5</a>.  Ensure Cryptographic Keys have Sufficient Entropy . . . .   <a href="#page-8">8</a>
     <a href="#section-3.6">3.6</a>.  Avoid Length-Dependent Encryption Inputs  . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.7">3.7</a>.  Use UTF-8 . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.8">3.8</a>.  Validate Issuer and Subject . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.9">3.9</a>.  Use and Validate Audience . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#section-3.10">3.10</a>. Do Not Trust Received Claims  . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-3.11">3.11</a>. Use Explicit Typing . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     3.12. Use Mutually Exclusive Validation Rules for Different
           Kinds of JWTs . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-4">4</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>
   <a href="#section-5">5</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-6">6</a>.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
   <a href="#section-7">7</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.1">7.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-7.2">7.2</a>.  Informative References  . . . . . . . . . . . . . . . . .  <a href="#page-13">13</a>
   <a href="#appendix-A">Appendix A</a>.  Document History . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.1">A.1</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-07">draft-ietf-oauth-jwt-bcp-07</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.2">A.2</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-06">draft-ietf-oauth-jwt-bcp-06</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.3">A.3</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-05">draft-ietf-oauth-jwt-bcp-05</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.4">A.4</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-04">draft-ietf-oauth-jwt-bcp-04</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.5">A.5</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-03">draft-ietf-oauth-jwt-bcp-03</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.6">A.6</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-02">draft-ietf-oauth-jwt-bcp-02</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>



<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 2]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-3"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


     <a href="#appendix-A.7">A.7</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-01">draft-ietf-oauth-jwt-bcp-01</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.8">A.8</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-00">draft-ietf-oauth-jwt-bcp-00</a> . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.9">A.9</a>.  <a href="/doc/html/draft-sheffer-oauth-jwt-bcp-01">draft-sheffer-oauth-jwt-bcp-01</a>  . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#appendix-A.10">A.10</a>. <a href="/doc/html/draft-sheffer-oauth-jwt-bcp-00">draft-sheffer-oauth-jwt-bcp-00</a>  . . . . . . . . . . . . .  <a href="#page-15">15</a>
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.%20%20Introduction"></a></body></html><a class="selflink" href="#section-1" id="section-1">1</a>.  Introduction</span>

   JSON Web Tokens, also known as JWTs [<a href="/doc/html/rfc7519" title='"JSON Web Token (JWT)"'>RFC7519</a>], are URL-safe JSON-
   based security tokens that contain a set of claims that can be signed
   and/or encrypted.  The JWT specification has seen rapid adoption
   because it encapsulates security-relevant information in one easy-to-
   protect location, and because it is easy to implement using widely-
   available tools.  One application area in which JWTs are commonly
   used is representing digital identity information, such as OpenID
   Connect ID Tokens [<a href="#ref-OpenID.Core">OpenID.Core</a>] and OAuth 2.0 [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>] access tokens
   and refresh tokens, the details of which are deployment-specific.

   Since the JWT specification was published, there have been several
   widely published attacks on implementations and deployments.  Such
   attacks are the result of under-specified security mechanisms, as
   well as incomplete implementations and incorrect usage by
   applications.

   The goal of this document is to facilitate secure implementation and
   deployment of JWTs.  Many of the recommendations in this document are
   about implementation and use of the cryptographic mechanisms
   underlying JWTs that are defined by JSON Web Signature (JWS)
   [<a href="/doc/html/rfc7515" title='"JSON Web Signature (JWS)"'>RFC7515</a>], JSON Web Encryption (JWE) [<a href="/doc/html/rfc7516" title='"JSON Web Encryption (JWE)"'>RFC7516</a>], and JSON Web
   Algorithms (JWA) [<a href="/doc/html/rfc7518" title='"JSON Web Algorithms (JWA)"'>RFC7518</a>].  Others are about use of the JWT claims
   themselves.

   These are intended to be minimum recommendations for the use of JWTs
   in the vast majority of implementation and deployment scenarios.
   Other specifications that reference this document can have stricter
   requirements related to one or more aspects of the format, based on
   their particular circumstances; when that is the case, implementers
   are advised to adhere to those stricter requirements.  Furthermore,
   this document provides a floor, not a ceiling, so stronger options
   are always allowed (e.g., depending on differing evaluations of the
   importance of cryptographic strength vs. computational load).

   Community knowledge about the strength of various algorithms and
   feasible attacks can change quickly, and experience shows that a Best
   Current Practice (BCP) document about security is a point-in-time
   statement.  Readers are advised to seek out any errata or updates
   that apply to this document.




<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 3]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-4"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.1.%20%20Target%20Audience"></a></body></html><a class="selflink" href="#section-1.1" id="section-1.1">1.1</a>.  Target Audience</span>

   The intended audience of this document is:

   -  Implementers of JWT libraries (and the JWS and JWE libraries used
      by those libraries),

   -  Implementers of code that uses such libraries (to the extent that
      some mechanisms may not be provided by libraries, or until they
      are), and

   -  Developers of specifications that rely on JWTs, both inside and
      outside the IETF.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/1.2.%20%20Conventions%20used%20in%20this%20document"></a></body></html><a class="selflink" href="#section-1.2" id="section-1.2">1.2</a>.  Conventions used in this document</span>

   The key words "<em>MUST</em>", "<em>MUST NOT</em>", "<em>REQUIRED</em>", "<em>SHALL</em>", "<em>SHALL NOT</em>",
   "<em>SHOULD</em>", "<em>SHOULD NOT</em>", "<em>RECOMMENDED</em>", "NOT <em>RECOMMENDED</em>", "<em>MAY</em>", and
   "<em>OPTIONAL</em>" in this document are to be interpreted as described in
   <a href="/doc/html/bcp14">BCP 14</a> [<a href="/doc/html/rfc2119" title='"Key words for use in RFCs to Indicate Requirement Levels"'>RFC2119</a>] [<a href="/doc/html/rfc8174" title='"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"'>RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.%20%20Threats%20and%20Vulnerabilities"></a></body></html><a class="selflink" href="#section-2" id="section-2">2</a>.  Threats and Vulnerabilities</span>

   This section lists some known and possible problems with JWT
   implementations and deployments.  Each problem description is
   followed by references to one or more mitigations to those problems.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.1.%20%20Weak%20Signatures%20and%20Insufficient%20Signature%20Validation"></a></body></html><a class="selflink" href="#section-2.1" id="section-2.1">2.1</a>.  Weak Signatures and Insufficient Signature Validation</span>

   Signed JSON Web Tokens carry an explicit indication of the signing
   algorithm, in the form of the "alg" header parameter, to facilitate
   cryptographic agility.  This, in conjunction with design flaws in
   some libraries and applications, have led to several attacks:

   -  The algorithm can be changed to "none" by an attacker, and some
      libraries would trust this value and "validate" the JWT without
      checking any signature.

   -  An "RS256" (RSA, 2048 bit) parameter value can be changed into
      "HS256" (HMAC, SHA-256), and some libraries would try to validate
      the signature using HMAC-SHA256 and using the RSA public key as
      the HMAC shared secret (see [<a href="#ref-McLean" title='"Critical vulnerabilities in JSON Web Token libraries"'>McLean</a>] and CVE-2015-9235).

   For mitigations, see <a href="#section-3.1">Section 3.1</a> and <a href="#section-3.2">Section 3.2</a>.






<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 4]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-5"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.2.%20%20Weak%20Symmetric%20Keys"></a></body></html><a class="selflink" href="#section-2.2" id="section-2.2">2.2</a>.  Weak Symmetric Keys</span>

   In addition, some applications use a keyed MAC algorithm such as
   "HS256" to sign tokens, but supply a weak symmetric key with
   insufficient entropy (such as a human memorable password).  Such keys
   are vulnerable to offline brute-force or dictionary attacks once an
   attacker gets hold of such a token [<a href="#ref-Langkemper">Langkemper</a>].

   For mitigations, see <a href="#section-3.5">Section 3.5</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.3.%20%20Incorrect%20Composition%20of%20Encryption%20and%20Signature"></a></body></html><a class="selflink" href="#section-2.3" id="section-2.3">2.3</a>.  Incorrect Composition of Encryption and Signature</span>

   Some libraries that decrypt a JWE-encrypted JWT to obtain a JWS-
   signed object do not always validate the internal signature.

   For mitigations, see <a href="#section-3.3">Section 3.3</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.4.%20%20Plaintext%20Leakage%20through%20Analysis%20of%20Ciphertext%20Length"></a></body></html><a class="selflink" href="#section-2.4" id="section-2.4">2.4</a>.  Plaintext Leakage through Analysis of Ciphertext Length</span>

   Many encryption algorithms leak information about the length of the
   plaintext, with a varying amount of leakage depending on the
   algorithm and mode of operation.  This problem is exacerbated when
   the plaintext is initially compressed, because the length of the
   compressed plaintext and, thus, the ciphertext depend not only on the
   length of the original plaintext but also on its content.
   Compression attacks are particularly powerful when there is attacker-
   controlled data in the same compression space as secret data, as is
   the case for some attacks on HTTPS.

   See [<a href="#ref-Kelsey" title='"Compression and Information Leakage of Plaintext"'>Kelsey</a>] for general background on compression and encryption,
   and [<a href="#ref-Alawatugoda">Alawatugoda</a>] for a specific example of attacks on HTTP cookies.

   For mitigations, see <a href="#section-3.6">Section 3.6</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.5.%20%20Insecure%20Use%20of%20Elliptic%20Curve%20Encryption"></a></body></html><a class="selflink" href="#section-2.5" id="section-2.5">2.5</a>.  Insecure Use of Elliptic Curve Encryption</span>

   Per [<a href="#ref-Sanso" title='"Critical Vulnerability Uncovered in JSON Encryption"'>Sanso</a>], several JOSE libraries fail to validate their inputs
   correctly when performing elliptic curve key agreement (the "ECDH-ES"
   algorithm).  An attacker that is able to send JWEs of its choosing
   that use invalid curve points and observe the cleartext outputs
   resulting from decryption with the invalid curve points can use this
   vulnerability to recover the recipient's private key.

   For mitigations, see <a href="#section-3.4">Section 3.4</a>.







<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 5]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-6"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.6.%20%20Multiplicity%20of%20JSON%20Encodings"></a></body></html><a class="selflink" href="#section-2.6" id="section-2.6">2.6</a>.  Multiplicity of JSON Encodings</span>

   Previous versions of the JSON format such as the obsoleted [<a href="/doc/html/rfc7159" title='"The JavaScript Object Notation (JSON) Data Interchange Format"'>RFC7159</a>]
   allowed several different character encodings: UTF-8, UTF-16 and UTF-
   32.  This is not the case anymore, with the latest standard [<a href="/doc/html/rfc8259" title='"The JavaScript Object Notation (JSON) Data Interchange Format"'>RFC8259</a>]
   only allowing UTF-8 except for internal use within a "closed
   ecosystem".  This ambiguity where older implementations and those
   used within closed environments may generate non-standard encodings,
   may result in the JWT being misinterpreted by its recipient.  This in
   turn could be used by a malicious sender to bypass the recipient's
   validation checks.

   For mitigations, see <a href="#section-3.7">Section 3.7</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.7.%20%20Substitution%20Attacks"></a></body></html><a class="selflink" href="#section-2.7" id="section-2.7">2.7</a>.  Substitution Attacks</span>

   There are attacks in which one recipient will be given a JWT that was
   intended for it, and will attempt to use it at a different recipient
   for which that JWT was not intended.  For instance, if an OAuth 2.0
   [<a href="/doc/html/rfc6749" title='"The OAuth 2.0 Authorization Framework"'>RFC6749</a>] access token is legitimately presented to an OAuth 2.0
   protected resource for which it is intended, that protected resource
   might then present that same access token to a different protected
   resource for which the access token is not intended, in an attempt to
   gain access.  If such situations are not caught, this can result in
   the attacker gaining access to resources that it is not entitled to
   access.

   For mitigations, see <a href="#section-3.8">Section 3.8</a> and <a href="#section-3.9">Section 3.9</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.8.%20%20Cross-JWT%20Confusion"></a></body></html><a class="selflink" href="#section-2.8" id="section-2.8">2.8</a>.  Cross-JWT Confusion</span>

   As JWTs are being used by more different protocols in diverse
   application areas, it becomes increasingly important to prevent cases
   of JWT tokens that have been issued for one purpose being subverted
   and used for another.  Note that this is a specific type of
   substitution attack.  If the JWT could be used in an application
   context in which it could be confused with other kinds of JWTs, then
   mitigations <em>MUST</em> be employed to prevent these substitution attacks.

   For mitigations, see <a href="#section-3.8">Section 3.8</a>, <a href="#section-3.9">Section 3.9</a>, <a href="#section-3.11">Section 3.11</a>, and
   <a href="#section-3.12">Section 3.12</a>.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/2.9.%20%20Indirect%20Attacks%20on%20the%20Server"></a></body></html><a class="selflink" href="#section-2.9" id="section-2.9">2.9</a>.  Indirect Attacks on the Server</span>

   Various JWT claims are used by the recipient to perform lookup
   operations, such as database and LDAP searches.  Others include URLs
   that are similarly looked up by the server.  Any of these claims can




<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 6]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-7"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   be used by an attacker as vectors for injection attacks or server-
   side request forgery (SSRF) attacks.

   For mitigations, see <a href="#section-3.10">Section 3.10</a>.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.%20%20Best%20Practices"></a></body></html><a class="selflink" href="#section-3" id="section-3">3</a>.  Best Practices</span>

   The best practices listed below should be applied by practitioners to
   mitigate the threats listed in the preceding section.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.1.%20%20Perform%20Algorithm%20Verification"></a></body></html><a class="selflink" href="#section-3.1" id="section-3.1">3.1</a>.  Perform Algorithm Verification</span>

   Libraries <em>MUST</em> enable the caller to specify a supported set of
   algorithms and <em>MUST NOT</em> use any other algorithms when performing
   cryptographic operations.  The library <em>MUST</em> ensure that the "alg" or
   "enc" header specifies the same algorithm that is used for the
   cryptographic operation.  Moreover, each key <em>MUST</em> be used with
   exactly one algorithm, and this <em>MUST</em> be checked when the
   cryptographic operation is performed.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.2.%20%20Use%20Appropriate%20Algorithms"></a></body></html><a class="selflink" href="#section-3.2" id="section-3.2">3.2</a>.  Use Appropriate Algorithms</span>

   As <a href="/doc/html/rfc7515#section-5.2">Section 5.2 of [RFC7515]</a> says, "it is an application decision
   which algorithms may be used in a given context.  Even if a JWS can
   be successfully validated, unless the algorithm(s) used in the JWS
   are acceptable to the application, it <em>SHOULD</em> consider the JWS to be
   invalid."

   Therefore, applications <em>MUST</em> only allow the use of cryptographically
   current algorithms that meet the security requirements of the
   application.  This set will vary over time as new algorithms are
   introduced and existing algorithms are deprecated due to discovered
   cryptographic weaknesses.  Applications <em>MUST</em> therefore be designed to
   enable cryptographic agility.

   That said, if a JWT is cryptographically protected end-to-end by a
   transport layer, such as TLS using cryptographically current
   algorithms, there may be no need to apply another layer of
   cryptographic protections to the JWT.  In such cases, the use of the
   "none" algorithm can be perfectly acceptable.  The "none" algorithm
   should only be used when the JWT is cryptographically protected by
   other means.  JWTs using "none" are often used in application
   contexts in which the content is optionally signed; then the URL-safe
   claims representation and processing can be the same in both the
   signed and unsigned cases.  JWT libraries <em>SHOULD NOT</em> generate JWTs
   using "none" unless explicitly requested to do by the caller.
   Similarly, JWT libraries <em>SHOULD NOT</em> consume JWTs using "none" unless
   explicitly requested by the caller.



<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 7]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-8"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   Applications <em>SHOULD</em> follow these algorithm-specific recommendations:

   -  Avoid all RSA-PKCS1 v1.5 encryption algorithms ([<a href="/doc/html/rfc8017" title='"PKCS #1: RSA Cryptography Specifications Version 2.2"'>RFC8017</a>], Sec.
      7.2}, preferring RSA-OAEP ([<a href="/doc/html/rfc8017" title='"PKCS #1: RSA Cryptography Specifications Version 2.2"'>RFC8017</a>], Sec. 7.1).

   -  ECDSA signatures [<a href="#ref-ANSI-X962-2005">ANSI-X962-2005</a>] require a unique random value
      for every message that is signed.  If even just a few bits of the
      random value are predictable across multiple messages then the
      security of the signature scheme may be compromised.  In the worst
      case, the private key may be recoverable by an attacker.  To
      counter these attacks, JWT libraries <em>SHOULD</em> implement ECDSA using
      the deterministic approach defined in [<a href="/doc/html/rfc6979" title='"Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)"'>RFC6979</a>].  This approach is
      completely compatible with existing ECDSA verifiers and so can be
      implemented without new algorithm identifiers being required.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.3.%20%20Validate%20All%20Cryptographic%20Operations"></a></body></html><a class="selflink" href="#section-3.3" id="section-3.3">3.3</a>.  Validate All Cryptographic Operations</span>

   All cryptographic operations used in the JWT <em>MUST</em> be validated and
   the entire JWT <em>MUST</em> be rejected if any of them fail to validate.
   This is true not only of JWTs with a single set of Header Parameters
   but also for Nested JWTs, in which both outer and inner operations
   <em>MUST</em> be validated using the keys and algorithms supplied by the
   application.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.4.%20%20Validate%20Cryptographic%20Inputs"></a></body></html><a class="selflink" href="#section-3.4" id="section-3.4">3.4</a>.  Validate Cryptographic Inputs</span>

   Some cryptographic operations, such as Elliptic Curve Diffie-Hellman
   key agreement ("ECDH-ES") take inputs that may contain invalid
   values, such as points not on the specified elliptic curve or other
   invalid points (see, e.g.  [<a href="#ref-Valenta" title='"In search of CurveSwap: Measuring elliptic curve implementations in the wild"'>Valenta</a>], Sec. 7.1).  The JWS/JWE library
   itself must validate these inputs before using them or it must use
   underlying cryptographic libraries that do so (or both!).

   ECDH-ES ephemeral public key (epk) inputs should be validated
   according to the recipient's chosen elliptic curve.  For the NIST
   prime-order curves P-256, P-384 and P-521, validation <em>MUST</em> be
   performed according to <a href="#section-5.6.2.3.4">Section 5.6.2.3.4</a> "ECC Partial Public-Key
   Validation Routine" of NIST Special Publication 800-56A revision 3
   [<a href="#ref-nist-sp-800-56a-r3">nist-sp-800-56a-r3</a>].  Likewise, if the "X25519" or "X448" [<a href="/doc/html/rfc8037" title='"CFRG Elliptic Curve Diffie-Hellman (ECDH) and Signatures in JSON Object Signing and Encryption (JOSE)"'>RFC8037</a>]
   algorithms are used, then the security considerations in [<a href="/doc/html/rfc8037" title='"CFRG Elliptic Curve Diffie-Hellman (ECDH) and Signatures in JSON Object Signing and Encryption (JOSE)"'>RFC8037</a>]
   apply.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.5.%20%20Ensure%20Cryptographic%20Keys%20have%20Sufficient%20Entropy"></a></body></html><a class="selflink" href="#section-3.5" id="section-3.5">3.5</a>.  Ensure Cryptographic Keys have Sufficient Entropy</span>

   The Key Entropy and Random Values advice in <a href="/doc/html/rfc7515#section-10.1">Section 10.1 of [RFC7515]</a>
   and the Password Considerations in <a href="/doc/html/rfc7518#section-8.8">Section 8.8 of [RFC7518]</a> <em>MUST</em> be
   followed.  In particular, human-memorizable passwords <em>MUST NOT</em> be
   directly used as the key to a keyed-MAC algorithm such as "HS256".



<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 8]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-9"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   In particular, passwords should only be used to perform key
   encryption, rather than content encryption, as described in
   <a href="/doc/html/rfc7518#section-4.8">Section 4.8 of [RFC7518]</a>.  Note that even when used for key
   encryption, password-based encryption is still subject to brute-force
   attacks.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.6.%20%20Avoid%20Length-Dependent%20Encryption%20Inputs"></a></body></html><a class="selflink" href="#section-3.6" id="section-3.6">3.6</a>.  Avoid Length-Dependent Encryption Inputs</span>

   Compression of data <em>SHOULD NOT</em> be done before encryption, because
   such compressed data often reveals information about the plaintext.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.7.%20%20Use%20UTF-8"></a></body></html><a class="selflink" href="#section-3.7" id="section-3.7">3.7</a>.  Use UTF-8</span>

   [<a href="/doc/html/rfc7515" title='"JSON Web Signature (JWS)"'>RFC7515</a>], [<a href="/doc/html/rfc7516" title='"JSON Web Encryption (JWE)"'>RFC7516</a>], and [<a href="/doc/html/rfc7519" title='"JSON Web Token (JWT)"'>RFC7519</a>] all specify that UTF-8 be used
   for encoding and decoding JSON used in Header Parameters and JWT
   Claims Sets.  This is also in line with the latest JSON specification
   [<a href="/doc/html/rfc8259" title='"The JavaScript Object Notation (JSON) Data Interchange Format"'>RFC8259</a>].  Implementations and applications <em>MUST</em> do this, and not
   use or admit the use of other Unicode encodings for these purposes.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.8.%20%20Validate%20Issuer%20and%20Subject"></a></body></html><a class="selflink" href="#section-3.8" id="section-3.8">3.8</a>.  Validate Issuer and Subject</span>

   When a JWT contains an "iss" (issuer) claim, the application <em>MUST</em>
   validate that the cryptographic keys used for the cryptographic
   operations in the JWT belong to the issuer.  If they do not, the
   application <em>MUST</em> reject the JWT.

   The means of determining the keys owned by an issuer is application-
   specific.  As one example, OpenID Connect [<a href="#ref-OpenID.Core">OpenID.Core</a>] issuer values
   are "https" URLs that reference a JSON metadata document that
   contains a "jwks_uri" value that is an "https" URL from which the
   issuer's keys are retrieved as a JWK Set [<a href="/doc/html/rfc7517" title='"JSON Web Key (JWK)"'>RFC7517</a>].  This same
   mechanism is used by [<a href="/doc/html/rfc8414" title='"OAuth 2.0 Authorization Server Metadata"'>RFC8414</a>].  Other applications may use different
   means of binding keys to issuers.

   Similarly, when the JWT contains a "sub" (subject) claim, the
   application <em>MUST</em> validate that the subject value corresponds to a
   valid subject and/or issuer/subject pair at the application.  This
   may include confirming that the issuer is trusted by the application.
   If the issuer, subject, or the pair are invalid, the application <em>MUST</em>
   reject the JWT.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.9.%20%20Use%20and%20Validate%20Audience"></a></body></html><a class="selflink" href="#section-3.9" id="section-3.9">3.9</a>.  Use and Validate Audience</span>

   If the same issuer can issue JWTs that are intended for use by more
   than one relying party or application, the JWT <em>MUST</em> contain an "aud"
   (audience) claim that can be used to determine whether the JWT is
   being used by an intended party or was substituted by an attacker at
   an unintended party.



<span class="grey">Sheffer, et al.          Expires April 15, 2020                 [Page 9]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-10"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   In such cases, the relying party or application <em>MUST</em> validate the
   audience value and if the audience value is not present or not
   associated with the recipient, it <em>MUST</em> reject the JWT.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.10.%20%20Do%20Not%20Trust%20Received%20Claims"></a></body></html><a class="selflink" href="#section-3.10" id="section-3.10">3.10</a>.  Do Not Trust Received Claims</span>

   The "kid" (key ID) header is used by the relying application to
   perform key lookup.  Applications should ensure that this does not
   create SQL or LDAP injection vulnerabilities, by validating and/or
   sanitizing the received value.

   Similarly, blindly following a "jku" (JWK set URL) or "x5u" (X.509
   URL) header, which may contain an arbitrary URL, could result in
   server-side request forgery (SSRF) attacks.  Applications <em>SHOULD</em>
   protect against such attacks, e.g., by matching the URL to a
   whitelist of allowed locations, and ensuring no cookies are sent in
   the GET request.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.11.%20%20Use%20Explicit%20Typing"></a></body></html><a class="selflink" href="#section-3.11" id="section-3.11">3.11</a>.  Use Explicit Typing</span>

   Sometimes, one kind of JWT can be confused for another.  If a
   particular kind of JWT is subject to such confusion, that JWT can
   include an explicit JWT type value, and the validation rules can
   specify checking the type.  This mechanism can prevent such
   confusion.  Explicit JWT typing is accomplished by using the "typ"
   header parameter.  For instance, the [<a href="/doc/html/rfc8417" title='"Security Event Token (SET)"'>RFC8417</a>] specification uses the
   "application/secevent+jwt" media type to perform explicit typing of
   Security Event Tokens (SETs).

   Per the definition of "typ" in <a href="/doc/html/rfc7515#section-4.1.9">Section 4.1.9 of [RFC7515]</a>, it is
   <em>RECOMMENDED</em> that the "application/" prefix be omitted from the "typ"
   value.  Therefore, for example, the "typ" value used to explicitly
   include a type for a SET <em>SHOULD</em> be "secevent+jwt".  When explicit
   typing is employed for a JWT, it is <em>RECOMMENDED</em> that a media type
   name of the format "application/example+jwt" be used, where "example"
   is replaced by the identifier for the specific kind of JWT.

   When applying explicit typing to a Nested JWT, the "typ" header
   parameter containing the explicit type value <em>MUST</em> be present in the
   inner JWT of the Nested JWT (the JWT whose payload is the JWT Claims
   Set).  In some cases the same "typ" header parameter value will be
   present in the outer JWT as well, to explicitly type the entire
   Nested JWT.

   Note that the use of explicit typing may not achieve disambiguation
   from existing kinds of JWTs, as the validation rules for existing
   kinds JWTs often do not use the "typ" header parameter value.
   Explicit typing is <em>RECOMMENDED</em> for new uses of JWTs.



<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 10]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-11"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/3.12.%20%20Use%20Mutually%20Exclusive%20Validation%20Rules%20for%20Different%20Kinds%20of"></a></body></html><a class="selflink" href="#section-3.12" id="section-3.12">3.12</a>.  Use Mutually Exclusive Validation Rules for Different Kinds of</span>
<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/%20%20%20%20%20%20%20JWTs"></a></body></html>       JWTs</span>

   Each application of JWTs defines a profile specifying the required
   and optional JWT claims and the validation rules associated with
   them.  If more than one kind of JWT can be issued by the same issuer,
   the validation rules for those JWTs <em>MUST</em> be written such that they
   are mutually exclusive, rejecting JWTs of the wrong kind.  To prevent
   substitution of JWTs from one context into another, application
   developers may employ a number of strategies:

   -  Use explicit typing for different kinds of JWTs.  Then the
      distinct "typ" values can be used to differentiate between the
      different kinds of JWTs.

   -  Use different sets of required claims or different required claim
      values.  Then the validation rules for one kind of JWT will reject
      those with different claims or values.

   -  Use different sets of required header parameters or different
      required header parameter values.  Then the validation rules for
      one kind of JWT will reject those with different header parameters
      or values.

   -  Use different keys for different kinds of JWTs.  Then the keys
      used to validate one kind of JWT will fail to validate other kinds
      of JWTs.

   -  Use different "aud" values for different uses of JWTs from the
      same issuer.  Then audience validation will reject JWTs
      substituted into inappropriate contexts.

   -  Use different issuers for different kinds of JWTs.  Then the
      distinct "iss" values can be used to segregate the different kinds
      of JWTs.

   Given the broad diversity of JWT usage and applications, the best
   combination of types, required claims, values, header parameters, key
   usages, and issuers to differentiate among different kinds of JWTs
   will, in general, be application specific.  As discussed in
   <a href="#section-3.11">Section 3.11</a>, for new JWT applications, the use of explicit typing is
   <em>RECOMMENDED</em>.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/4.%20%20Security%20Considerations"></a></body></html><a class="selflink" href="#section-4" id="section-4">4</a>.  Security Considerations</span>

   This entire document is about security considerations when
   implementing and deploying JSON Web Tokens.




<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 11]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-12"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/5.%20%20IANA%20Considerations"></a></body></html><a class="selflink" href="#section-5" id="section-5">5</a>.  IANA Considerations</span>

   This document requires no IANA actions.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/6.%20%20Acknowledgements"></a></body></html><a class="selflink" href="#section-6" id="section-6">6</a>.  Acknowledgements</span>

   Thanks to Antonio Sanso for bringing the "ECDH-ES" invalid point
   attack to the attention of JWE and JWT implementers.  Tim McLean
   [<a href="#ref-McLean" title='"Critical vulnerabilities in JSON Web Token libraries"'>McLean</a>] published the RSA/HMAC confusion attack.  Thanks to Nat
   Sakimura for advocating the use of explicit typing.  Thanks to Neil
   Madden for his numerous comments, and to Carsten Bormann, Brian
   Campbell, Brian Carpenter, Alissa Cooper, Roman Danyliw, Ben Kaduk,
   Mirja Kuehlewind, Barry Leiba, Eric Rescorla, Adam Roach, Martin
   Vigoureux, and Eric Vyncke for their reviews.

<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.%20%20References"></a></body></html><a class="selflink" href="#section-7" id="section-7">7</a>.  References</span>

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.1.%20%20Normative%20References"></a></body></html><a class="selflink" href="#section-7.1" id="section-7.1">7.1</a>.  Normative References</span>

   [<a id="ref-nist-sp-800-56a-r3">nist-sp-800-56a-r3</a>]
              Barker, E., Chen, L., Keller, S., Roginsky, A., Vassilev,
              A., and R. Davis, "Recommendation for Pair-Wise Key
              Establishment Schemes Using Discrete Logarithm
              Cryptography, Draft NIST Special Publication 800-56A
              Revision 3", April 2018,
              &lt;<a href="https://doi.org/10.6028/NIST.SP.800-56Ar3">https://doi.org/10.6028/NIST.SP.800-56Ar3</a>&gt;.

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a id="ref-RFC6979">RFC6979</a>]  Pornin, T., "Deterministic Usage of the Digital Signature
              Algorithm (DSA) and Elliptic Curve Digital Signature
              Algorithm (ECDSA)", <a href="/doc/html/rfc6979">RFC 6979</a>, DOI 10.17487/RFC6979, August
              2013, &lt;<a href="https://www.rfc-editor.org/info/rfc6979">https://www.rfc-editor.org/info/rfc6979</a>&gt;.

   [<a id="ref-RFC7515">RFC7515</a>]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web
              Signature (JWS)", <a href="/doc/html/rfc7515">RFC 7515</a>, DOI 10.17487/RFC7515, May
              2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;.

   [<a id="ref-RFC7516">RFC7516</a>]  Jones, M. and J. Hildebrand, "JSON Web Encryption (JWE)",
              <a href="/doc/html/rfc7516">RFC 7516</a>, DOI 10.17487/RFC7516, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7516">https://www.rfc-editor.org/info/rfc7516</a>&gt;.

   [<a id="ref-RFC7518">RFC7518</a>]  Jones, M., "JSON Web Algorithms (JWA)", <a href="/doc/html/rfc7518">RFC 7518</a>,
              DOI 10.17487/RFC7518, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7518">https://www.rfc-editor.org/info/rfc7518</a>&gt;.



<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 12]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-13"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   [<a id="ref-RFC7519">RFC7519</a>]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", <a href="/doc/html/rfc7519">RFC 7519</a>, DOI 10.17487/RFC7519, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7519">https://www.rfc-editor.org/info/rfc7519</a>&gt;.

   [<a id="ref-RFC8017">RFC8017</a>]  Moriarty, K., Ed., Kaliski, B., Jonsson, J., and A. Rusch,
              "PKCS #1: RSA Cryptography Specifications Version 2.2",
              <a href="/doc/html/rfc8017">RFC 8017</a>, DOI 10.17487/RFC8017, November 2016,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8017">https://www.rfc-editor.org/info/rfc8017</a>&gt;.

   [<a id="ref-RFC8037">RFC8037</a>]  Liusvaara, I., "CFRG Elliptic Curve Diffie-Hellman (ECDH)
              and Signatures in JSON Object Signing and Encryption
              (JOSE)", <a href="/doc/html/rfc8037">RFC 8037</a>, DOI 10.17487/RFC8037, January 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8037">https://www.rfc-editor.org/info/rfc8037</a>&gt;.

   [<a id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="/doc/html/rfc2119">RFC</a>
              <a href="/doc/html/rfc2119">2119</a> Key Words", <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.

   [<a id="ref-RFC8259">RFC8259</a>]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", STD 90, <a href="/doc/html/rfc8259">RFC 8259</a>,
              DOI 10.17487/RFC8259, December 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8259">https://www.rfc-editor.org/info/rfc8259</a>&gt;.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/7.2.%20%20Informative%20References"></a></body></html><a class="selflink" href="#section-7.2" id="section-7.2">7.2</a>.  Informative References</span>

   [<a id="ref-Alawatugoda">Alawatugoda</a>]
              Alawatugoda, J., Stebila, D., and C. Boyd, "Protecting
              Encrypted Cookies from Compression Side-Channel Attacks",
              Financial Cryptography and Data Security pp. 86-106,
              DOI 10.1007/978-3-662-47854-7_6, 2015.

   [<a id="ref-ANSI-X962-2005">ANSI-X962-2005</a>]
              "American National Standard X9.62: The Elliptic Curve
              Digital Signature Algorithm (ECDSA)", November 2005.

   [<a id="ref-Kelsey">Kelsey</a>]   Kelsey, J., "Compression and Information Leakage of
              Plaintext", Fast Software Encryption pp. 263-276,
              DOI 10.1007/3-540-45661-9_21, 2002.

   [<a id="ref-Langkemper">Langkemper</a>]
              Langkemper, S., "Attacking JWT Authentication", September
              2016, &lt;<a href="https://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/">https://www.sjoerdlangkemper.nl/2016/09/28/</a>
              <a href="https://www.sjoerdlangkemper.nl/2016/09/28/attacking-jwt-authentication/">attacking-jwt-authentication/</a>&gt;.

   [<a id="ref-McLean">McLean</a>]   McLean, T., "Critical vulnerabilities in JSON Web Token
              libraries", March 2015, &lt;<a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries//">https://auth0.com/blog/critical-</a>
              <a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries//">vulnerabilities-in-json-web-token-libraries//</a>&gt;.




<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 13]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-14"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


   [<a id="ref-OpenID.Core">OpenID.Core</a>]
              Sakimura, N., Bradley, J., Jones, M., Medeiros, B., and C.
              Mortimore, "OpenID Connect Core 1.0", November 2014,
              &lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;.

   [<a id="ref-RFC6749">RFC6749</a>]  Hardt, D., Ed., "The OAuth 2.0 Authorization Framework",
              <a href="/doc/html/rfc6749">RFC 6749</a>, DOI 10.17487/RFC6749, October 2012,
              &lt;<a href="https://www.rfc-editor.org/info/rfc6749">https://www.rfc-editor.org/info/rfc6749</a>&gt;.

   [<a id="ref-RFC7159">RFC7159</a>]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", <a href="/doc/html/rfc7159">RFC 7159</a>, DOI 10.17487/RFC7159, March
              2014, &lt;<a href="https://www.rfc-editor.org/info/rfc7159">https://www.rfc-editor.org/info/rfc7159</a>&gt;.

   [<a id="ref-RFC7517">RFC7517</a>]  Jones, M., "JSON Web Key (JWK)", <a href="/doc/html/rfc7517">RFC 7517</a>,
              DOI 10.17487/RFC7517, May 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7517">https://www.rfc-editor.org/info/rfc7517</a>&gt;.

   [<a id="ref-RFC8414">RFC8414</a>]  Jones, M., Sakimura, N., and J. Bradley, "OAuth 2.0
              Authorization Server Metadata", <a href="/doc/html/rfc8414">RFC 8414</a>,
              DOI 10.17487/RFC8414, June 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8414">https://www.rfc-editor.org/info/rfc8414</a>&gt;.

   [<a id="ref-RFC8417">RFC8417</a>]  Hunt, P., Ed., Jones, M., Denniss, W., and M. Ansari,
              "Security Event Token (SET)", <a href="/doc/html/rfc8417">RFC 8417</a>,
              DOI 10.17487/RFC8417, July 2018,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8417">https://www.rfc-editor.org/info/rfc8417</a>&gt;.

   [<a id="ref-Sanso">Sanso</a>]    Sanso, A., "Critical Vulnerability Uncovered in JSON
              Encryption", March 2017,
              &lt;<a href="https://blogs.adobe.com/security/2017/03/critical-vulnerability-uncovered-in-json-encryption.html">https://blogs.adobe.com/security/2017/03/critical-</a>
              <a href="https://blogs.adobe.com/security/2017/03/critical-vulnerability-uncovered-in-json-encryption.html">vulnerability-uncovered-in-json-encryption.html</a>&gt;.

   [<a id="ref-Valenta">Valenta</a>]  Valenta, L., Sullivan, N., Sanso, A., and N. Heninger, "In
              search of CurveSwap: Measuring elliptic curve
              implementations in the wild", March 2018,
              &lt;<a href="https://ia.cr/2018/298">https://ia.cr/2018/298</a>&gt;.















<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 14]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-15"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


<span class="h2"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/Appendix%20A.%20%20Document%20History"></a></body></html><a class="selflink" href="#appendix-A" id="appendix-A">Appendix A</a>.  Document History</span>

   [[ to be removed by the RFC editor before publication as an RFC ]]

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.1.%20%20draft-ietf-oauth-jwt-bcp-07"></a></body></html><a class="selflink" href="#appendix-A.1" id="appendix-A.1">A.1</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-07">draft-ietf-oauth-jwt-bcp-07</a></span>

   -  IESG review comments.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.2.%20%20draft-ietf-oauth-jwt-bcp-06"></a></body></html><a class="selflink" href="#appendix-A.2" id="appendix-A.2">A.2</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-06">draft-ietf-oauth-jwt-bcp-06</a></span>

   -  Second AD review.

   -  Removed unworkable recommendation to pad encrypted passwords.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.3.%20%20draft-ietf-oauth-jwt-bcp-05"></a></body></html><a class="selflink" href="#appendix-A.3" id="appendix-A.3">A.3</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-05">draft-ietf-oauth-jwt-bcp-05</a></span>

   -  Genart review comments.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.4.%20%20draft-ietf-oauth-jwt-bcp-04"></a></body></html><a class="selflink" href="#appendix-A.4" id="appendix-A.4">A.4</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-04">draft-ietf-oauth-jwt-bcp-04</a></span>

   -  AD review comments.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.5.%20%20draft-ietf-oauth-jwt-bcp-03"></a></body></html><a class="selflink" href="#appendix-A.5" id="appendix-A.5">A.5</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-03">draft-ietf-oauth-jwt-bcp-03</a></span>

   -  Acknowledgements.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.6.%20%20draft-ietf-oauth-jwt-bcp-02"></a></body></html><a class="selflink" href="#appendix-A.6" id="appendix-A.6">A.6</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-02">draft-ietf-oauth-jwt-bcp-02</a></span>

   -  Implemented WGLC feedback.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.7.%20%20draft-ietf-oauth-jwt-bcp-01"></a></body></html><a class="selflink" href="#appendix-A.7" id="appendix-A.7">A.7</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-01">draft-ietf-oauth-jwt-bcp-01</a></span>

   -  Feedback from Brian Campbell.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.8.%20%20draft-ietf-oauth-jwt-bcp-00"></a></body></html><a class="selflink" href="#appendix-A.8" id="appendix-A.8">A.8</a>.  <a href="/doc/html/draft-ietf-oauth-jwt-bcp-00">draft-ietf-oauth-jwt-bcp-00</a></span>

   -  Initial WG draft.  No change from the latest individual version.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.9.%20%20draft-sheffer-oauth-jwt-bcp-01"></a></body></html><a class="selflink" href="#appendix-A.9" id="appendix-A.9">A.9</a>.  <a href="/doc/html/draft-sheffer-oauth-jwt-bcp-01">draft-sheffer-oauth-jwt-bcp-01</a></span>

   -  Added explicit typing.

<span class="h3"><html><body><a class="dashAnchor" name="//apple_ref/cpp/Shortcut/A.10.%20%20draft-sheffer-oauth-jwt-bcp-00"></a></body></html><a class="selflink" href="#appendix-A.10" id="appendix-A.10">A.10</a>.  <a href="/doc/html/draft-sheffer-oauth-jwt-bcp-00">draft-sheffer-oauth-jwt-bcp-00</a></span>

   -  Initial version.






<span class="grey">Sheffer, et al.          Expires April 15, 2020                [Page 15]</span></pre>
<hr class="noprint"/><!--NewPage--><pre class="newpage"><span id="page-16"></span>
<span class="grey">Internet-Draft                   JWT BCP                    October 2019</span>


Authors' Addresses

   Yaron Sheffer
   Intuit

   EMail: yaronf.ietf@gmail.com


   Dick Hardt

   EMail: dick.hardt@gmail.com


   Michael B. Jones
   Microsoft

   EMail: mbj@microsoft.com
   URI:   <a href="http://self-issued.info/">http://self-issued.info/</a>

































Sheffer, et al.          Expires April 15, 2020                [Page 16]
</pre>
</div>
</div>
</div>
<script>$(".visible-nojs").removeClass("visible-nojs");</script>
<script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
<script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>
</body>
</html>
