<!DOCTYPE html> 

<!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/htmlized_base.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
  
    draft-ietf-oauth-assertions-18
  
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>

  @media only screen 
    and (min-width: 992px)
    and (max-width: 1199px) {
      body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 768px)
    and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-width: 480px)
    and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
  @media only screen 
    and (min-device-width : 375px) 
    and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
  @media only screen 
    and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
      font-weight: bold;
            /* line-height: 0pt; */
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
      font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
  .pre {
      white-space: pre;
      font-family: monospace;
  }
  .header{
      font-weight: bold;
  }
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        @media print {
            body {
                margin-top: 5em;
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
  @media screen {
      .grey, .grey a:link, .grey a:visited {
    color: #777;
      }
            .meta-info {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .pad {
                padding-top: 7px;
                line-height: 24px;
                padding-bottom: 4px;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
  }
    
     

.bgwhite  { background-color: white; }
.bgred    { background-color: #F44; }
.bggrey   { background-color: #666; }
.bgbrown  { background-color: #840; }            
.bgorange { background-color: #FA0; }
.bgyellow { background-color: #EE0; }
.bgmagenta{ background-color: #F4F; }
.bgblue   { background-color: #66F; }
.bgcyan   { background-color: #4DD; }
.bggreen  { background-color: #4F4; }

.draftcontent { margin-top:0px !important;}


    </style>

    <!--[if lt IE 9]>
        <script src="https://www.ietf.org/lib/dt/7.38.0/html5shiv/html5shiv.min.js"></script>
        <script src="https://www.ietf.org/lib/dt/7.38.0/respond/dest/respond.min.js"></script>
    <![endif]-->
    
  <link rel="alternate" type="application/atom+xml" title="Document changes" href="/feed/document-changes/draft-ietf-oauth-assertions/">
  <meta name="description" content="Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants (Internet-Draft, 2014)">
  <script src="https://www.ietf.org/lib/dt/7.38.0/d3/d3.min.js"></script>
  <script src="https://www.ietf.org/lib/dt/7.38.0/jquery/jquery.min.js"></script>


    
    <link rel="shortcut icon" href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/ietf-icon-blue3.png">
    
    <link rel="apple-touch-icon" href="https://www.ietf.org/lib/dt/7.38.0/ietf/images/apple-touch-icon.png">
  </head>

  <body style="padding-top: 0;">

	  <div class="content" id="content">
        
  <!-- template: /a/www/ietf-datatracker/web/ietf/templates/doc/document_html.html -->
 
  <div class="rfcmarkup">
    <div class="noprint" style="height: 6px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showLegend();"
         onmouseout="hideLegend()"
         style="height: 6px; min-height: 6px; width: 96ex; position: absolute; margin-top:0; "
         class="meta-info bgred"
         title="Click for colour legend." >&nbsp;</div>
      <div id="legend"
           class="meta-info noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showLegend();"
           onmouseout="hideLegend();">
      </div>
    </div>

    
      <div class="noprint">
	 <pre class="pre meta-info">[<a href="https://datatracker.ietf.org" title="Document search and retrieval page">Search</a>] [<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-assertions-18.txt" title="Plaintext version of this document">txt</a>|<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-assertions-18.xml" title="XML source for this document">xml</a>|<a href="https://www.ietf.org/archive/id/draft-ietf-oauth-assertions-18.pdf" title="PDF version of this document">pdf</a>|<a href="/doc/draft-ietf-oauth-assertions/18/bibtex" title="BibTex entry for this document">bibtex</a>] [<a href="/doc/draft-ietf-oauth-assertions/" title="Datatracker information for this document">Tracker</a>] [<a href="/group/oauth/" title="The working group handling this document">WG</a>] [<a href="mailto:draft-ietf-oauth-assertions@ietf.org?subject=draft-ietf-oauth-assertions" title="Send email to the document authors">Email</a>] [<a href="https://www.ietf.org/rfcdiff?difftype=--hwdiff&url2=draft-ietf-oauth-assertions-18.txt" title="Inline diff (wdiff)">Diff1</a>] [<a href="https://www.ietf.org/rfcdiff?url2=draft-ietf-oauth-assertions-18.txt" title="Side-by-side diff">Diff2</a>] [<a href="https://www.ietf.org/tools/idnits?url=https://www.ietf.org/archive/id/draft-ietf-oauth-assertions-18.txt" title="Run an idnits check of this document">Nits</a>]

Versions: <a href="/doc/html/draft-ietf-oauth-assertions-00">00</a> <a href="/doc/html/draft-ietf-oauth-assertions-01">01</a> <a href="/doc/html/draft-ietf-oauth-assertions-02">02</a> <a href="/doc/html/draft-ietf-oauth-assertions-03">03</a> <a href="/doc/html/draft-ietf-oauth-assertions-04">04</a> <a href="/doc/html/draft-ietf-oauth-assertions-05">05</a> <a href="/doc/html/draft-ietf-oauth-assertions-06">06</a> <a href="/doc/html/draft-ietf-oauth-assertions-07">07</a> <a href="/doc/html/draft-ietf-oauth-assertions-08">08</a> <a href="/doc/html/draft-ietf-oauth-assertions-09">09</a> <a href="/doc/html/draft-ietf-oauth-assertions-10">10</a> <a href="/doc/html/draft-ietf-oauth-assertions-11">11</a> <a href="/doc/html/draft-ietf-oauth-assertions-12">12</a>         Standards Track
          <a href="/doc/html/draft-ietf-oauth-assertions-13">13</a> <a href="/doc/html/draft-ietf-oauth-assertions-14">14</a> <a href="/doc/html/draft-ietf-oauth-assertions-15">15</a> <a href="/doc/html/draft-ietf-oauth-assertions-16">16</a> <a href="/doc/html/draft-ietf-oauth-assertions-17">17</a> <a href="/doc/html/draft-ietf-oauth-assertions-18"><b>18</b></a> <a href="/doc/html/rfc7521">rfc7521</a>                                     </pre>
      </div>
    

    <div class="draftcontent">
    <pre>OAuth Working Group                                          B. Campbell
Internet-Draft                                             Ping Identity
Intended status: Standards Track                            C. Mortimore
Expires: April 24, 2015                                       Salesforce
                                                                M. Jones
                                                               Y. Goland
                                                               Microsoft
                                                        October 21, 2014


      <span class="h1">Assertion Framework for OAuth 2.0 Client Authentication and</span>
                          <span class="h1">Authorization Grants</span>
                     <span class="h1">draft-ietf-oauth-assertions-18</span>

Abstract

   This specification provides a framework for the use of assertions
   with OAuth 2.0 in the form of a new client authentication mechanism
   and a new authorization grant type.  Mechanisms are specified for
   transporting assertions during interactions with a token endpoint, as
   well as general processing rules.

   The intent of this specification is to provide a common framework for
   OAuth 2.0 to interwork with other identity systems using assertions,
   and to provide alternative client authentication mechanisms.

   Note that this specification only defines abstract message flows and
   processing rules.  In order to be implementable, companion
   specifications are necessary to provide the corresponding concrete
   instantiations.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="/doc/html/bcp78">BCP 78</a> and <a href="/doc/html/bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as &quot;work in progress.&quot;

   This Internet-Draft will expire on April 24, 2015.




<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 1]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-2" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="/doc/html/bcp78">BCP 78</a> and the IETF Trust&#x27;s Legal
   Provisions Relating to IETF Documents
   (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-2">2</a>.  Notational Conventions  . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-3">3</a>.  Framework . . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
   <a href="#section-4">4</a>.  Transporting Assertions . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
     <a href="#section-4.1">4.1</a>.  Using Assertions as Authorization Grants  . . . . . . . .   <a href="#page-7">7</a>
       <a href="#section-4.1.1">4.1.1</a>.  Error Responses . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-4.2">4.2</a>.  Using Assertions for Client Authentication  . . . . . . .   <a href="#page-8">8</a>
       <a href="#section-4.2.1">4.2.1</a>.  Error Responses . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#section-5">5</a>.  Assertion Content and Processing  . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-5.1">5.1</a>.  Assertion Metamodel . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#section-5.2">5.2</a>.  General Assertion Format and Processing Rules . . . . . .  <a href="#page-11">11</a>
   <a href="#section-6">6</a>.  Common Scenarios  . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.1">6.1</a>.  Client Authentication . . . . . . . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.2">6.2</a>.  Client Acting on Behalf of Itself . . . . . . . . . . . .  <a href="#page-12">12</a>
     <a href="#section-6.3">6.3</a>.  Client Acting on Behalf of a User . . . . . . . . . . . .  <a href="#page-13">13</a>
       <a href="#section-6.3.1">6.3.1</a>.  Client Acting on Behalf of an Anonymous User  . . . .  <a href="#page-13">13</a>
   <a href="#section-7">7</a>.  Interoperability Considerations . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
   <a href="#section-8">8</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .  <a href="#page-14">14</a>
     <a href="#section-8.1">8.1</a>.  Forged Assertion  . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-8.2">8.2</a>.  Stolen Assertion  . . . . . . . . . . . . . . . . . . . .  <a href="#page-15">15</a>
     <a href="#section-8.3">8.3</a>.  Unauthorized Disclosure of Personal Information . . . . .  <a href="#page-16">16</a>
     <a href="#section-8.4">8.4</a>.  Privacy Considerations  . . . . . . . . . . . . . . . . .  <a href="#page-16">16</a>
   <a href="#section-9">9</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-9.1">9.1</a>.  assertion Parameter Registration  . . . . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-9.2">9.2</a>.  client_assertion Parameter Registration . . . . . . . . .  <a href="#page-17">17</a>
     <a href="#section-9.3">9.3</a>.  client_assertion_type Parameter Registration  . . . . . .  <a href="#page-17">17</a>
   <a href="#section-10">10</a>. References  . . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
     <a href="#section-10.1">10.1</a>.  Normative References . . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
     <a href="#section-10.2">10.2</a>.  Informative References . . . . . . . . . . . . . . . . .  <a href="#page-18">18</a>
   <a href="#appendix-A">Appendix A</a>.  Acknowledgements . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>
   <a href="#appendix-B">Appendix B</a>.  Document History . . . . . . . . . . . . . . . . . .  <a href="#page-19">19</a>



<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 2]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-3" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   Authors&#x27; Addresses  . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-23">23</a>

<span class="h2"><a class="selflink" id="section-1" href="#section-1">1</a>.  Introduction</span>

   An assertion is a package of information that facilitates the sharing
   of identity and security information across security domains.
   <a href="#section-3">Section 3</a> provides a more detailed description of the concept of an
   assertion for the purpose of this specification.

   OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>] is an authorization framework that enables a
   third-party application to obtain limited access to a protected HTTP
   resource.  In OAuth, those third-party applications are called
   clients; they access protected resources by presenting an access
   token to the HTTP resource.  Access tokens are issued to clients by
   an authorization server with the (sometimes implicit) approval of the
   resource owner.  These access tokens are typically obtained by
   exchanging an authorization grant, which represents the authorization
   granted by the resource owner (or by a privileged administrator).
   Several authorization grant types are defined to support a wide range
   of client types and user experiences.  OAuth also provides an
   extensibility mechanism for defining additional grant types, which
   can serve as a bridge between OAuth and other protocol frameworks.

   This specification provides a general framework for the use of
   assertions as authorization grants with OAuth 2.0.  It also provides
   a framework for assertions to be used for client authentication.  It
   provides generic mechanisms for transporting assertions during
   interactions with an authorization server&#x27;s token endpoint, as well
   as general rules for the content and processing of those assertions.
   The intent is to provide an alternative client authentication
   mechanism (one that doesn&#x27;t send client secrets), as well as to
   facilitate the use of OAuth 2.0 in client-server integration
   scenarios, where the end-user may not be present.

   This specification only defines abstract message flows and processing
   rules.  In order to be implementable, companion specifications are
   necessary to provide the corresponding concrete instantiations.  For
   instance, SAML 2.0 Profile for OAuth 2.0 Client Authentication and
   Authorization Grants [<a href="#ref-I-D.ietf-oauth-saml2-bearer">I-D.ietf-oauth-saml2-bearer</a>] defines a concrete
   instantiation for SAML 2.0 assertions and JSON Web Token (JWT)
   Profile for OAuth 2.0 Client Authentication and Authorization Grants
   [<a href="#ref-I-D.ietf-oauth-jwt-bearer">I-D.ietf-oauth-jwt-bearer</a>] defines a concrete instantiation for
   JWTs.

   Note: The use of assertions for client authentication is orthogonal
   to and separable from using assertions as an authorization grant.
   They can be used either in combination or separately.  Client
   assertion authentication is nothing more than an alternative way for



<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 3]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-4" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   a client to authenticate to the token endpoint and must be used in
   conjunction with some grant type to form a complete and meaningful
   protocol request.  Assertion authorization grants may be used with or
   without client authentication or identification.  Whether or not
   client authentication is needed in conjunction with an assertion
   authorization grant, as well as the supported types of client
   authentication, are policy decisions at the discretion of the
   authorization server.

<span class="h2"><a class="selflink" id="section-2" href="#section-2">2</a>.  Notational Conventions</span>

   The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
   &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
   document are to be interpreted as described in [<a href="/doc/html/rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] .

   Throughout this document, values are quoted to indicate that they are
   to be taken literally.  When using these values in protocol messages,
   the quotes must not be used as part of the value.

<span class="h2"><a class="selflink" id="section-3" href="#section-3">3</a>.  Framework</span>

   An assertion is a package of information that allows identity and
   security information to be shared across security domains.  An
   assertion typically contains information about a subject or
   principal, information about the party that issued the assertion and
   when was it issued, as well as the conditions under which the
   assertion is to be considered valid, such as when and where it can be
   used.

   The entity that creates and signs or integrity protects the assertion
   is typically known as the &quot;Issuer&quot; and the entity that consumes the
   assertion and relies on its information is typically known as the
   &quot;Relying Party&quot;.  In the context of this document, the authorization
   server acts as a relying party.

   Assertions used in the protocol exchanges defined by this
   specification MUST always be integrity protected using a digital
   signature or Message Authentication Code applied by the issuer, which
   authenticates the issuer and ensures integrity of the assertion
   content.  In many cases, the assertion is issued by a third party and
   it must be protected against tampering by the client that presents
   it.  An assertion MAY additionally be encrypted, preventing
   unauthorized parties (such as the client) from inspecting the
   content.

   Although this document does not define the processes by which the
   client obtains the assertion (prior to sending it to the
   authorization server), there are two common patterns described below.



<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 4]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-5" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   In the first pattern, depicted in Figure 1, the client obtains an
   assertion from a third party entity capable of issuing, renewing,
   transforming, and validating security tokens.  Typically such an
   entity is known as a &quot;Security Token Service&quot; (STS) or just &quot;Token
   Service&quot; and a trust relationship (usually manifested in the exchange
   of some kind of key material) exists between the token service and
   the relying party.  The token service is the assertion issuer; its
   role is to fulfill requests from clients, which present various
   credentials, and mint assertions as requested, fill them with
   appropriate information, and integrity protect them with a signature
   or message authentication code.  WS-Trust [<a href="#ref-OASIS.WS-Trust">OASIS.WS-Trust</a>] is one
   available standard for requesting security tokens (assertions).

     Relying
     Party                     Client                   Token Service
       |                          |                         |
       |                          |  1) Request Assertion   |
       |                          |------------------------&gt;|
       |                          |                         |
       |                          |  2) Assertion           |
       |                          |&lt;------------------------|
       |    3) Assertion          |                         |
       |&lt;-------------------------|                         |
       |                          |                         |
       |    4) OK or Failure      |                         |
       |-------------------------&gt;|                         |
       |                          |                         |
       |                          |                         |

                  Figure 1: Third Party Created Assertion

   In the second pattern, depicted in Figure 2, the client creates
   assertions locally.  To apply the signatures or message
   authentication codes to assertions, it has to obtain key material:
   either symmetric keys or asymmetric key pairs.  The mechanisms for
   obtaining this key material are beyond the scope of this
   specification.

   Although assertions are usually used to convey identity and security
   information, self-issued assertions can also serve a different
   purpose.  They can be used to demonstrate knowledge of some secret,
   such as a client secret, without actually communicating the secret
   directly in the transaction.  In that case, additional information
   included in the assertion by the client itself will be of limited
   value to the relying party and, for this reason, only a bare minimum
   of information is typically included in such an assertion, such as
   information about issuing and usage conditions.




<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 5]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-6" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


     Relying
     Party                     Client
       |                          |
       |                          | 1) Create
       |                          |    Assertion
       |                          |--------------+
       |                          |              |
       |                          | 2) Assertion |
       |                          |&lt;-------------+
       |    3) Assertion          |
       |&lt;-------------------------|
       |                          |
       |    4) OK or Failure      |
       |-------------------------&gt;|
       |                          |
       |                          |

                      Figure 2: Self-Issued Assertion

   Deployments need to determine the appropriate variant to use based on
   the required level of security, the trust relationship between the
   entities, and other factors.

   From the perspective of what must be done by the entity presenting
   the assertion, there are two general types of assertions:

   1.  Bearer Assertions: Any entity in possession of a bearer assertion
       (the bearer) can use it to get access to the associated resources
       (without demonstrating possession of a cryptographic key).  To
       prevent misuse, bearer assertions need to be protected from
       disclosure in storage and in transport.  Secure communication
       channels are required between all entities to avoid leaking the
       assertion to unauthorized parties.

   2.  Holder-of-Key Assertions: To access the associated resources, the
       entity presenting the assertion must demonstrate possession of
       additional cryptographic material.  The token service thereby
       binds a key identifier to the assertion and the client has to
       demonstrate to the relying party that it knows the key
       corresponding to that identifier when presenting the assertion.

   The protocol parameters and processing rules defined in this document
   are intended to support a client presenting a bearer assertion to an
   authorization server.  They are not directly suitable for use with
   holder-of-key assertions.  While they could be used as a baseline for
   a holder-of-key assertion system, there would be a need for
   additional mechanisms (to support proof-of-possession of the secret




<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 6]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-7" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   key), and possibly changes to the security model (e.g., to relax the
   requirement for an Audience).

<span class="h2"><a class="selflink" id="section-4" href="#section-4">4</a>.  Transporting Assertions</span>

   This section defines HTTP parameters for transporting assertions
   during interactions with a token endpoint of an OAuth authorization
   server.  Because requests to the token endpoint result in the
   transmission of clear-text credentials (in both the HTTP request and
   response), all requests to the token endpoint MUST use TLS, as
   mandated in <a href="#section-3.2">Section 3.2</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].

<span class="h3"><a class="selflink" id="section-4.1" href="#section-4.1">4.1</a>.  Using Assertions as Authorization Grants</span>

   This section defines the use of assertions as authorization grants,
   based on the definition provided in <a href="#section-4.5">Section 4.5</a> of OAuth 2.0
   [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  When using assertions as authorization grants, the client
   includes the assertion and related information using the following
   HTTP request parameters:

   grant_type
      REQUIRED.  The format of the assertion as defined by the
      authorization server.  The value will be an absolute URI.

   assertion
      REQUIRED.  The assertion being used as an authorization grant.
      Specific serialization of the assertion is defined by profile
      documents.

   scope
      OPTIONAL.  The requested scope as described in <a href="#section-3.3">Section 3.3</a> of
      OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  When exchanging assertions for access
      tokens, the authorization for the token has been previously
      granted through some out-of-band mechanism.  As such, the
      requested scope MUST be equal or lesser than the scope originally
      granted to the authorized accessor.  The Authorization Server MUST
      limit the scope of the issued access token to be equal or lesser
      than the scope originally granted to the authorized accessor.

   Authentication of the client is optional, as described in
   <a href="#section-3.2.1">Section 3.2.1</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>] and consequently, the
   &quot;client_id&quot; is only needed when a form of client authentication that
   relies on the parameter is used.

   The following example demonstrates an assertion being used as an
   authorization grant (with extra line breaks for display purposes
   only):




<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 7]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-8" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


     POST /token HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded

     grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Asaml2-bearer&amp;
     assertion=PHNhbWxwOl...[omitted for brevity]...ZT4

   An assertion used in this context is generally a short lived
   representation of the authorization grant and authorization servers
   SHOULD NOT issue access tokens with a lifetime that exceeds the
   validity period of the assertion by a significant period.  In
   practice, that will usually mean that refresh tokens are not issued
   in response to assertion grant requests and access tokens will be
   issued with a reasonably short lifetime.  Clients can refresh an
   expired access token by requesting a new one using the same
   assertion, if it is still valid, or with a new assertion.

   An IETF URN for use as the &quot;grant_type&quot; value can be requested using
   the template in [<a href="/doc/html/rfc6755" title="&quot;An IETF URN Sub-Namespace for OAuth&quot;">RFC6755</a>].  A URN of the form
   urn:ietf:params:oauth:grant-type:* is suggested.

<span class="h4"><a class="selflink" id="section-4.1.1" href="#section-4.1.1">4.1.1</a>.  Error Responses</span>

   If an assertion is not valid or has expired, the Authorization Server
   constructs an error response as defined in OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  The
   value of the &quot;error&quot; parameter MUST be the &quot;invalid_grant&quot; error
   code.  The authorization server MAY include additional information
   regarding the reasons the assertion was considered invalid using the
   &quot;error_description&quot; or &quot;error_uri&quot; parameters.

   For example:

     HTTP/1.1 400 Bad Request
     Content-Type: application/json
     Cache-Control: no-store

     {
       &quot;error&quot;:&quot;invalid_grant&quot;,
       &quot;error_description&quot;:&quot;Audience validation failed&quot;
     }

<span class="h3"><a class="selflink" id="section-4.2" href="#section-4.2">4.2</a>.  Using Assertions for Client Authentication</span>

   The following section defines the use of assertions as client
   credentials as an extension of <a href="#section-2.3">Section 2.3</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].
   When using assertions as client credentials, the client includes the
   assertion and related information using the following HTTP request
   parameters:



<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 8]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-9" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   client_assertion_type
      REQUIRED.  The format of the assertion as defined by the
      authorization server.  The value will be an absolute URI.

   client_assertion
      REQUIRED.  The assertion being used to authenticate the client.
      Specific serialization of the assertion is defined by profile
      documents.

   client_id
      OPTIONAL.  The client identifier as described in <a href="#section-2.2">Section 2.2</a> of
      OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  The &quot;client_id&quot; is unnecessary for client
      assertion authentication because the client is identified by the
      subject of the assertion.  If present, the value of the
      &quot;client_id&quot; parameter MUST identify the same client as is
      identified by the client assertion.

   The following example demonstrates a client authenticating using an
   assertion during an Access Token Request, as defined in <a href="#section-4.1.3">Section 4.1.3</a>
   of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>] (with extra line breaks for display purposes
   only):

     POST /token HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded

     grant_type=authorization_code&amp;
     code=i1WsRn1uB1&amp;
     client_assertion_type=urn%3Aietf%3Aparams%3Aoauth
     %3Aclient-assertion-type%3Asaml2-bearer&amp;
     client_assertion=PHNhbW...[omitted for brevity]...ZT

   Token endpoints can differentiate between assertion based credentials
   and other client credential types by looking for the presence of the
   &quot;client_assertion&quot; and &quot;client_assertion_type&quot; parameters, which will
   only be present when using assertions for client authentication.

   An IETF URN for use as the &quot;client_assertion_type&quot; value may be
   requested using the template in [<a href="/doc/html/rfc6755" title="&quot;An IETF URN Sub-Namespace for OAuth&quot;">RFC6755</a>].  A URN of the form
   urn:ietf:params:oauth:client-assertion-type:* is suggested.

<span class="h4"><a class="selflink" id="section-4.2.1" href="#section-4.2.1">4.2.1</a>.  Error Responses</span>

   If an assertion is invalid for any reason or if more than one client
   authentication mechanism is used, the Authorization Server constructs
   an error response as defined in OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  The value of
   the &quot;error&quot; parameter MUST be the &quot;invalid_client&quot; error code.  The
   authorization server MAY include additional information regarding the



<span class="grey">Campbell, et al.         Expires April 24, 2015                 [Page 9]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-10" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   reasons the client assertion was considered invalid using the
   &quot;error_description&quot; or &quot;error_uri&quot; parameters.

   For example:

     HTTP/1.1 400 Bad Request
     Content-Type: application/json
     Cache-Control: no-store

     {
       &quot;error&quot;:&quot;invalid_client&quot;
       &quot;error_description&quot;:&quot;assertion has expired&quot;
     }

<span class="h2"><a class="selflink" id="section-5" href="#section-5">5</a>.  Assertion Content and Processing</span>

   This section provides a general content and processing model for the
   use of assertions in OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].

<span class="h3"><a class="selflink" id="section-5.1" href="#section-5.1">5.1</a>.  Assertion Metamodel</span>

   The following are entities and metadata involved in the issuance,
   exchange, and processing of assertions in OAuth 2.0.  These are
   general terms, abstract from any particular assertion format.
   Mappings of these terms into specific representations are provided by
   profiles of this specification.

   Issuer
      A unique identifier for the entity that issued the assertion.
      Generally this is the entity that holds the key material used to
      sign or integrity protect the assertion.  Examples of issuers are
      OAuth clients (when assertions are self-issued) and third party
      security token services.  If the assertion is self-issued, the
      Issuer value is the client identifier.  If the assertion was
      issued by a Security Token Service (STS), the Issuer should
      identify the STS in a manner recognized by the Authorization
      Server.  In the absence of an application profile specifying
      otherwise, compliant applications MUST compare Issuer values using
      the Simple String Comparison method defined in <a href="/doc/html/rfc3986#section-6.2.1">Section&nbsp;6.2.1 of
      RFC 3986</a> [<a href="/doc/html/rfc3986" title="&quot;Uniform Resource Identifier (URI): Generic Syntax&quot;">RFC3986</a>].

   Subject
      A unique identifier for the principal that is the subject of the
      assertion.

      *  When using assertions for client authentication, the Subject
         identifies the client to the authorization server using the
         value of the &quot;client_id&quot; of the OAuth client.



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 10]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-11" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


      *  When using assertions as an authorization grant, the Subject
         identifies an authorized accessor for which the access token is
         being requested (typically the resource owner, or an authorized
         delegate).

   Audience
      A value that identifies the party or parties intended to process
      the assertion.  The URL of the Token Endpoint, as defined in
      <a href="#section-3.2">Section 3.2</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>], can be used to indicate that
      the authorization server as a valid intended audience of the
      assertion.  In the absence of an application profile specifying
      otherwise, compliant applications MUST compare the audience values
      using the Simple String Comparison method defined in <a href="/doc/html/rfc3986#section-6.2.1">Section&nbsp;6.2.1
      of RFC 3986</a> [<a href="/doc/html/rfc3986" title="&quot;Uniform Resource Identifier (URI): Generic Syntax&quot;">RFC3986</a>].

   Issued At
      The time at which the assertion was issued.  While the
      serialization may differ by assertion format, it is REQUIRED that
      the time be expressed in UTC with no time zone component.

   Expires At
      The time at which the assertion expires.  While the serialization
      may differ by assertion format, it is REQUIRED that the time be
      expressed in UTC with no time zone component.

   Assertion ID
      A nonce or unique identifier for the assertion.  The Assertion ID
      may be used by implementations requiring message de-duplication
      for one-time use assertions.  Any entity that assigns an
      identifier MUST ensure that there is negligible probability that
      that entity or any other entity will accidentally assign the same
      identifier to a different data object.

<span class="h3"><a class="selflink" id="section-5.2" href="#section-5.2">5.2</a>.  General Assertion Format and Processing Rules</span>

   The following are general format and processing rules for the use of
   assertions in OAuth:

   o  The assertion MUST contain an Issuer.  The Issuer identifies the
      entity that issued the assertion as recognized by the
      Authorization Server.  If an assertion is self-issued, the Issuer
      MUST be the value of the client&#x27;s &quot;client_id&quot;.

   o  The assertion MUST contain a Subject.  The Subject typically
      identifies an authorized accessor for which the access token is
      being requested (i.e., the resource owner or an authorized
      delegate), but in some cases, may be a pseudonymous identifier or
      other value denoting an anonymous user.  When the client is acting



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 11]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-12" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


      on behalf of itself, the Subject MUST be the value of the client&#x27;s
      &quot;client_id&quot;.

   o  The assertion MUST contain an Audience that identifies the
      Authorization Server as the intended audience.  The Authorization
      Server MUST reject any assertion that does not contain the its own
      identity as the intended audience.

   o  The assertion MUST contain an Expires At entity that limits the
      time window during which the assertion can be used.  The
      authorization server MUST reject assertions that have expired
      (subject to allowable clock skew between systems).  Note that the
      authorization server may reject assertions with an Expires At
      attribute value that is unreasonably far in the future.

   o  The assertion MAY contain an Issued At entity containing the UTC
      time at which the assertion was issued.

   o  The Authorization Server MUST reject assertions with an invalid
      signature or Message Authentication Code.  The algorithm used to
      validate the signature or message authentication code and the
      mechanism for designating the secret used to generate the
      signature or message authentication code over the assertion are
      beyond the scope of this specification.

<span class="h2"><a class="selflink" id="section-6" href="#section-6">6</a>.  Common Scenarios</span>

   The following provides additional guidance, beyond the format and
   processing rules defined in <a href="#section-4">Section 4</a> and <a href="#section-5">Section 5</a>, on assertion use
   for a number of common use cases.

<span class="h3"><a class="selflink" id="section-6.1" href="#section-6.1">6.1</a>.  Client Authentication</span>

   A client uses an assertion to authenticate to the authorization
   server&#x27;s token endpoint by using the &quot;client_assertion_type&quot; and
   &quot;client_assertion&quot; parameters as defined in <a href="#section-4.2">Section 4.2</a>.  The Subject
   of the assertion identifies the client.  If the assertion is self-
   issued by the client, the Issuer of the assertion also identifies the
   client.

   The example in <a href="#section-4.2">Section 4.2</a> shows a client authenticating using an
   assertion during an Access Token Request.

<span class="h3"><a class="selflink" id="section-6.2" href="#section-6.2">6.2</a>.  Client Acting on Behalf of Itself</span>

   When a client is accessing resources on behalf of itself, it does so
   in a manner analogous to the Client Credentials Grant defined in
   <a href="#section-4.4">Section 4.4</a> of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].  This is a special case that



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 12]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-13" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   combines both the authentication and authorization grant usage
   patterns.  In this case, the interactions with the authorization
   server should be treated as using an assertion for Client
   Authentication according to <a href="#section-4.2">Section 4.2</a>, while using the grant_type
   parameter with the value &quot;client_credentials&quot; to indicate that the
   client is requesting an access token using only its client
   credentials.

   The following example demonstrates an assertion being used for a
   Client Credentials Access Token Request, as defined in <a href="#section-4.4.2">Section 4.4.2</a>
   of OAuth 2.0 [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>] (with extra line breaks for display purposes
   only):

     POST /token HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded

     grant_type=client_credentials&amp;
     client_assertion_type=urn%3Aietf%3Aparams%3Aoauth
     %3Aclient-assertion-type%3Asaml2-bearer&amp;
     client_assertion=PHNhbW...[omitted for brevity]...ZT

<span class="h3"><a class="selflink" id="section-6.3" href="#section-6.3">6.3</a>.  Client Acting on Behalf of a User</span>

   When a client is accessing resources on behalf of a user, it does so
   by using the &quot;grant_type&quot; and &quot;assertion&quot; parameters as defined in
   <a href="#section-4.1">Section 4.1</a>.  The Subject identifies an authorized accessor for which
   the access token is being requested (typically the resource owner, or
   an authorized delegate).

   The example in <a href="#section-4.1">Section 4.1</a> shows a client making an Access Token
   Request using an assertion as an Authorization Grant.

<span class="h4"><a class="selflink" id="section-6.3.1" href="#section-6.3.1">6.3.1</a>.  Client Acting on Behalf of an Anonymous User</span>

   When a client is accessing resources on behalf of an anonymous user,
   a mutually agreed upon Subject identifier indicating anonymity is
   used.  The Subject value might be an opaque persistent or transient
   pseudonymous identifier for the user or be an agreed upon static
   value indicating an anonymous user (e.g., &quot;anonymous&quot;).  The
   authorization may be based upon additional criteria, such as
   additional attributes or claims provided in the assertion.  For
   example, a client might present an assertion from a trusted issuer
   asserting that the bearer is over 18 via an included claim.  In this
   case, no additional information about the user&#x27;s identity is
   included, yet all the data needed to issue an access token is
   present.




<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 13]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-14" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   More information about anonymity, pseudonymity, and privacy
   considerations in general can be found in [<a href="/doc/html/rfc6973" title="&quot;Privacy Considerations for Internet Protocols&quot;">RFC6973</a>].

<span class="h2"><a class="selflink" id="section-7" href="#section-7">7</a>.  Interoperability Considerations</span>

   This specification defines a framework for using assertions with
   OAuth 2.0.  However, as an abstract framework in which the data
   formats used for representing many values are not defined, on its
   own, this specification is not sufficient to produce interoperable
   implementations.

   Two other specifications that profile this framework for specific
   assertion have been developed: one [<a href="#ref-I-D.ietf-oauth-saml2-bearer">I-D.ietf-oauth-saml2-bearer</a>] uses
   SAML 2.0-based assertions and the other [<a href="#ref-I-D.ietf-oauth-jwt-bearer">I-D.ietf-oauth-jwt-bearer</a>]
   uses JSON Web Tokens (JWTs).  These two instantiations of this
   framework specify additional details about the assertion encoding and
   processing rules for using those kinds of assertions with OAuth 2.0.

   However, even when profiled for specific assertion types, agreements
   between system entities regarding identifiers, keys, and endpoints
   are required in order to achieve interoperable deployments.  Specific
   items that require agreement are as follows: values for the issuer
   and audience identifiers, supported assertion and client
   authentication types, the location of the token endpoint, the key
   used to apply and verify the digital signature or Message
   Authentication Code over the assertion, one-time use restrictions on
   assertions, maximum assertion lifetime allowed, and the specific
   subject and attribute requirements of the assertion.  The exchange of
   such information is explicitly out of scope for this specification.
   Deployments for particular trust frameworks, circles of trust, or
   other uses cases will need to agree among the participants on the
   kinds of values to be used for some abstract fields defined by this
   specification.  In some cases, additional profiles may be created
   that constrain or prescribe these values or specify how they are to
   be exchanged.  The OAuth 2.0 Dynamic Client Registration Core
   Protocol [<a href="#ref-I-D.ietf-oauth-dyn-reg">I-D.ietf-oauth-dyn-reg</a>] is one such profile that enables
   OAuth Clients to register metadata about themselves at an
   Authorization Server.

<span class="h2"><a class="selflink" id="section-8" href="#section-8">8</a>.  Security Considerations</span>

   This section discusses security considerations that apply when using
   assertions with OAuth 2.0 as described in this document.  As
   discussed in <a href="#section-3">Section 3</a>, there are two different ways to obtain
   assertions: either as self-issued or obtained from a third party
   token service.  While the actual interactions for obtaining an
   assertion are outside the scope of this document, the details are
   important from a security perspective.  <a href="#section-3">Section 3</a> discusses the high



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 14]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-15" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   level architectural aspects.  Many of the security considerations
   discussed in this section are applicable to both the OAuth exchange
   as well as the client obtaining the assertion.

   The remainder of this section focuses on the exchanges that concern
   presenting an assertion for client authentication and for the
   authorization grant.

<span class="h3"><a class="selflink" id="section-8.1" href="#section-8.1">8.1</a>.  Forged Assertion</span>

   Threat:
      An adversary could forge or alter an assertion in order to obtain
      an access token (in case of the authorization grant) or to
      impersonate a client (in case of the client authentication
      mechanism).


   Countermeasures:
      To avoid this kind of attack, the entities must assure that proper
      mechanisms for protecting the integrity of the assertion are
      employed.  This includes the issuer digitally signing the
      assertion or computing a keyed message digest over the assertion.

<span class="h3"><a class="selflink" id="section-8.2" href="#section-8.2">8.2</a>.  Stolen Assertion</span>

   Threat:
      An adversary may be able obtain an assertion (e.g., by
      eavesdropping) and then reuse it (replay it) at a later point in
      time.


   Countermeasures:
      The primary mitigation for this threat is the use of secure
      communication channels with server authentication for all network
      exchanges.

      An assertion may also contain several elements to prevent replay
      attacks.  There is, however, a clear tradeoff between reusing an
      assertion for multiple exchanges and obtaining and creating new
      fresh assertions.

      Authorization Servers and Resource Servers may use a combination
      of the Assertion ID and Issued At/Expires At attributes for replay
      protection.  Previously processed assertions may be rejected based
      on the Assertion ID.  The addition of the validity window relieves
      the authorization server from maintaining an infinite state table
      of processed Assertion IDs.




<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 15]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-16" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


<span class="h3"><a class="selflink" id="section-8.3" href="#section-8.3">8.3</a>.  Unauthorized Disclosure of Personal Information</span>

   Threat:
      The ability for other entities to obtain information about an
      individual, such as authentication information, role in an
      organization, or other authorization relevant information, raises
      privacy concerns.


   Countermeasures:
      To address the threats, two cases need to be differentiated:

      First, a third party that did not participate in any of the
      exchange is prevented from eavesdropping on the content of the
      assertion by employing confidentiality protection of the exchange
      using TLS.  This ensures that an eavesdropper on the wire is
      unable to obtain information.  However, this does not prevent
      legitimate protocol entities from obtaining information that they
      are not allowed to possess from assertions.  Some assertion
      formats allow for the assertion to be encrypted, preventing
      unauthorized parties from inspecting the content.

      Second, an Authorization Server may obtain an assertion that was
      created by a third party token service and that token service may
      have placed attributes into the assertion.  To mitigate potential
      privacy problems, prior consent for the release of such attribute
      information from the resource owner should be obtained.  OAuth
      itself does not directly provide such capabilities, but this
      consent approval may be obtained using other identity management
      protocols, user consent interactions, or in an out-of-band
      fashion.

      For the cases where a third party token service creates assertions
      to be used for client authentication, privacy concerns are
      typically lower, since many of these clients are Web servers
      rather than individual devices operated by humans.  If the
      assertions are used for client authentication of devices or
      software that can be closely linked to end users, then privacy
      protection safeguards need to be taken into consideration.

      Further guidance on privacy friendly protocol design can be found
      in [<a href="/doc/html/rfc6973" title="&quot;Privacy Considerations for Internet Protocols&quot;">RFC6973</a>].

<span class="h3"><a class="selflink" id="section-8.4" href="#section-8.4">8.4</a>.  Privacy Considerations</span>

   An assertion may contain privacy-sensitive information and, to
   prevent disclosure of such information to unintended parties, should
   only be transmitted over encrypted channels, such as TLS.  In cases



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 16]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-17" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   where it is desirable to prevent disclosure of certain information
   the client, the assertion, or portions of it, should be be encrypted
   to the authorization server.

   Deployments should determine the minimum amount of information
   necessary to complete the exchange and include only such information
   in the assertion.  In some cases, the subject identifier can be a
   value representing an anonymous or pseudonymous user, as described in
   <a href="#section-6.3.1">Section 6.3.1</a>.

<span class="h2"><a class="selflink" id="section-9" href="#section-9">9</a>.  IANA Considerations</span>

   This is a request to add three values, as listed in the sub-sections
   below, to the &quot;OAuth Parameters&quot; registry established by <a href="/doc/html/rfc6749">RFC 6749</a>
   [<a href="/doc/html/rfc6749" title="&quot;The OAuth 2.0 Authorization Framework&quot;">RFC6749</a>].

<span class="h3"><a class="selflink" id="section-9.1" href="#section-9.1">9.1</a>.  assertion Parameter Registration</span>

   o  Parameter name: assertion

   o  Parameter usage location: token request

   o  Change controller: IESG

   o  Specification document(s): [[this document]]

<span class="h3"><a class="selflink" id="section-9.2" href="#section-9.2">9.2</a>.  client_assertion Parameter Registration</span>

   o  Parameter name: client_assertion

   o  Parameter usage location: token request

   o  Change controller: IESG

   o  Specification document(s): [[this document]]

<span class="h3"><a class="selflink" id="section-9.3" href="#section-9.3">9.3</a>.  client_assertion_type Parameter Registration</span>

   o  Parameter name: client_assertion_type

   o  Parameter usage location: token request

   o  Change controller: IESG

   o  Specification document(s): [[this document]]






<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 17]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-18" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


<span class="h2"><a class="selflink" id="section-10" href="#section-10">10</a>.  References</span>

<span class="h3"><a class="selflink" id="section-10.1" href="#section-10.1">10.1</a>.  Normative References</span>

   [<a id="ref-RFC2119">RFC2119</a>]  Bradner, S., &quot;Key words for use in RFCs to Indicate
              Requirement Levels&quot;, <a href="/doc/html/bcp14">BCP 14</a>, <a href="/doc/html/rfc2119">RFC 2119</a>, March 1997.

   [<a id="ref-RFC3986">RFC3986</a>]  Berners-Lee, T., Fielding, R., and L. Masinter, &quot;Uniform
              Resource Identifier (URI): Generic Syntax&quot;, STD 66, <a href="/doc/html/rfc3986">RFC</a>
              <a href="/doc/html/rfc3986">3986</a>, January 2005.

   [<a id="ref-RFC6749">RFC6749</a>]  Hardt, D., &quot;The OAuth 2.0 Authorization Framework&quot;, <a href="/doc/html/rfc6749">RFC</a>
              <a href="/doc/html/rfc6749">6749</a>, October 2012.

<span class="h3"><a class="selflink" id="section-10.2" href="#section-10.2">10.2</a>.  Informative References</span>

   [<a id="ref-I-D.ietf-oauth-dyn-reg">I-D.ietf-oauth-dyn-reg</a>]
              Richer, J., Jones, M., Bradley, J., Machulak, M., and P.
              Hunt, &quot;OAuth 2.0 Dynamic Client Registration Protocol&quot;,
              <a href="/doc/html/draft-ietf-oauth-dyn-reg-20">draft-ietf-oauth-dyn-reg-20</a> (work in progress), August
              2014.

   [<a id="ref-I-D.ietf-oauth-jwt-bearer">I-D.ietf-oauth-jwt-bearer</a>]
              Jones, M., Campbell, B., and C. Mortimore, &quot;JSON Web Token
              (JWT) Profile for OAuth 2.0 Client Authentication and
              Authorization Grants&quot;, <a href="/doc/html/draft-ietf-oauth-jwt-bearer">draft-ietf-oauth-jwt-bearer</a> (work
              in progress), October 2014.

   [<a id="ref-I-D.ietf-oauth-saml2-bearer">I-D.ietf-oauth-saml2-bearer</a>]
              Campbell, B., Mortimore, C., and M. Jones, &quot;SAML 2.0
              Profile for OAuth 2.0 Client Authentication and
              Authorization Grants&quot;, <a href="/doc/html/draft-ietf-oauth-saml2-bearer">draft-ietf-oauth-saml2-bearer</a> (work
              in progress), October 2014.

   [<a id="ref-OASIS.WS-Trust">OASIS.WS-Trust</a>]
              Nadalin, A., Ed., Goodner, M., Ed., Gudgin, M., Ed.,
              Barbir, A., Ed., and H. Granqvist, Ed., &quot;WS-Trust&quot;, Feb
              2009.

   [<a id="ref-RFC6755">RFC6755</a>]  Campbell, B. and H. Tschofenig, &quot;An IETF URN Sub-Namespace
              for OAuth&quot;, <a href="/doc/html/rfc6755">RFC 6755</a>, October 2012.

   [<a id="ref-RFC6973">RFC6973</a>]  Cooper, A., Tschofenig, H., Aboba, B., Peterson, J.,
              Morris, J., Hansen, M., and R. Smith, &quot;Privacy
              Considerations for Internet Protocols&quot;, <a href="/doc/html/rfc6973">RFC 6973</a>, July
              2013.





<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 18]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-19" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


<span class="h2"><a class="selflink" id="appendix-A" href="#appendix-A">Appendix A</a>.  Acknowledgements</span>

   The authors wish to thank the following people that have influenced
   or contributed this specification: Paul Madsen, Eric Sachs, Jian Cai,
   Tony Nadalin, Hannes Tschofenig, the authors of the OAuth WRAP
   specification, and the members of the OAuth working group.

<span class="h2"><a class="selflink" id="appendix-B" href="#appendix-B">Appendix B</a>.  Document History</span>

   [[ to be removed by the RFC editor before publication as an RFC ]]

   <a href="/doc/html/draft-ietf-oauth-assertions-18">draft-ietf-oauth-assertions-18</a>

   o  Changes/suggestions from IESG reviews.

   <a href="/doc/html/draft-ietf-oauth-assertions-17">draft-ietf-oauth-assertions-17</a>

   o  Added Privacy Considerations section per AD review discussion
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg13148.html">http://www.ietf.org/mail-archive/web/oauth/current/msg13148.html</a>
      and <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg13144.html">http://www.ietf.org/mail-archive/web/oauth/current/</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg13144.html">msg13144.html</a>

   <a href="/doc/html/draft-ietf-oauth-assertions-16">draft-ietf-oauth-assertions-16</a>

   o  Clarified some text around the treatment of subject based on the
      rough rough consensus from the thread staring at
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12630.html">http://www.ietf.org/mail-archive/web/oauth/current/msg12630.html</a>

   <a href="/doc/html/draft-ietf-oauth-assertions-15">draft-ietf-oauth-assertions-15</a>

   o  Updated references.

   o  Improved formatting of hanging lists.

   <a href="/doc/html/draft-ietf-oauth-assertions-14">draft-ietf-oauth-assertions-14</a>

   o  Update reference: <a href="/doc/html/draft-iab-privacy-considerations">draft-iab-privacy-considerations</a> is now <a href="/doc/html/rfc6973">RFC 6973</a>

   o  Update reference: <a href="/doc/html/draft-ietf-oauth-dyn-reg">draft-ietf-oauth-dyn-reg</a> from -13 to -15

   <a href="/doc/html/draft-ietf-oauth-assertions-13">draft-ietf-oauth-assertions-13</a>

   o  Clean up language around subject per the subject part of
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12155.html">http://www.ietf.org/mail-archive/web/oauth/current/msg12155.html</a>

   o  Replace &quot;Client Credentials flow&quot; by &quot;Client Credentials _Grant_&quot;
      as suggested in <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12155.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12155.html">archive/web/oauth/current/msg12155.html</a>



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 19]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-20" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   o  For consistency with SAML and JWT per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12251.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12251.html">archive/web/oauth/current/msg12251.html</a> and <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12253.html">http://www.ietf.org/</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg12253.html">mail-archive/web/oauth/current/msg12253.html</a> Stated that &quot;In the
      absence of an application profile specifying otherwise, compliant
      applications MUST compare the audience values using the Simple
      String Comparison method defined in <a href="/doc/html/rfc3986#section-6.2.1">Section&nbsp;6.2.1 of RFC 3986</a>.&quot;

   o  Added one-time use, maximum lifetime, and specific subject and
      attribute requirements to Interoperability Considerations.

   <a href="/doc/html/draft-ietf-oauth-assertions-12">draft-ietf-oauth-assertions-12</a>

   o  Stated that issuer and audience values SHOULD be compared using
      the Simple String Comparison method defined in <a href="/doc/html/rfc3986#section-6.2.1">Section&nbsp;6.2.1 of
      RFC 3986</a> unless otherwise specified by the application.

   <a href="/doc/html/draft-ietf-oauth-assertions-11">draft-ietf-oauth-assertions-11</a>

   o  Addressed comments from IESG evaluation
      <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-assertions/ballot/">https://datatracker.ietf.org/doc/draft-ietf-oauth-assertions/</a>
      <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-assertions/ballot/">ballot/</a>.

   o  Reworded Interoperability Considerations to state what
      identifiers, keys, endpoints, etc.  need to be exchanged/agreed
      upon.

   o  Added brief description of assertion to the into and included a
      reference to <a href="#section-3">Section 3</a> (Framework) where it&#x27;s described more.

   o  Changed such that a self-issued assertion must (was should) have
      the client id as the issuer.

   o  Changed &quot;Specific Assertion Format and Processing Rules&quot; to
      &quot;Common Scenarios&quot; and reworded to be more suggestive of common
      practices, rather than trying to be normative.  Also removed lots
      of repetitive text in that section.

   o  Refined language around audience, subject, client identifiers,
      etc.  to hopefully be clearer and less redundant.

   o  Changed title from &quot;Assertion Framework for OAuth 2.0&quot; to
      &quot;Assertion Framework for OAuth 2.0 Client Authentication and
      Authorization Grants&quot; to be more explicit about the scope of the
      document per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg11063.html">http://www.ietf.org/mail-archive/web/oauth/current/</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg11063.html">msg11063.html</a>.

   o  Noted that authentication of the client per <a href="#section-3.2.1">Section 3.2.1</a> of OAuth
      is optional for an access token request with an assertion as an



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 20]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-21" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


      authorization grant and removed client_id from the associated
      example.

   <a href="/doc/html/draft-ietf-oauth-assertions-10">draft-ietf-oauth-assertions-10</a>

   o  Changed term &quot;Principal&quot; to &quot;Subject&quot;.

   o  Added Interoperability Considerations section.

   o  Applied Shawn Emery&#x27;s comments from the security directorate
      review, including correcting urn:ietf:params:oauth:grant_type:* to
      urn:ietf:params:oauth:grant-type:*.

   <a href="/doc/html/draft-ietf-oauth-assertions-09">draft-ietf-oauth-assertions-09</a>

   o  Allow audience values to not be URIs.

   o  Added informative references to <a href="/doc/html/draft-ietf-oauth-saml2-bearer">draft-ietf-oauth-saml2-bearer</a> and
      <a href="/doc/html/draft-ietf-oauth-jwt-bearer">draft-ietf-oauth-jwt-bearer</a>.

   o  Clarified that the statements about possible issuers are non-
      normative by using the language &quot;Examples of issuers&quot;.

   <a href="/doc/html/draft-ietf-oauth-assertions-08">draft-ietf-oauth-assertions-08</a>

   o  Update reference to <a href="/doc/html/rfc6755">RFC 6755</a> from <a href="/doc/html/draft-ietf-oauth-urn-sub-ns">draft-ietf-oauth-urn-sub-ns</a>

   o  Tidy up IANA consideration section

   <a href="/doc/html/draft-ietf-oauth-assertions-07">draft-ietf-oauth-assertions-07</a>

   o  Reference <a href="/doc/html/rfc6749">RFC 6749</a>.

   o  Remove extraneous word per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg10029.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg10029.html">archive/web/oauth/current/msg10029.html</a>

   <a href="/doc/html/draft-ietf-oauth-assertions-06">draft-ietf-oauth-assertions-06</a>

   o  Add more text to intro explaining that an assertion grant type can
      be used with or without client authentication/identification and
      that client assertion authentication is nothing more than an
      alternative way for a client to authenticate to the token endpoint

   <a href="/doc/html/draft-ietf-oauth-assertions-05">draft-ietf-oauth-assertions-05</a>

   o  Non-normative editorial cleanups

   <a href="/doc/html/draft-ietf-oauth-assertions-04">draft-ietf-oauth-assertions-04</a>



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 21]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-22" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   o  Updated document to incorporate the review comments from the
      shepherd - thread and alternative draft at <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg09437.html">http://www.ietf.org/</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg09437.html">mail-archive/web/oauth/current/msg09437.html</a>

   o  Added reference to <a href="/doc/html/draft-ietf-oauth-urn-sub-ns">draft-ietf-oauth-urn-sub-ns</a> and include
      suggestions on urn:ietf:params:oauth:[grant-type|client-assertion-
      type]:* URNs

   <a href="/doc/html/draft-ietf-oauth-assertions-03">draft-ietf-oauth-assertions-03</a>

   o  updated reference to <a href="/doc/html/draft-ietf-oauth-v2">draft-ietf-oauth-v2</a> from -25 to -26

   <a href="/doc/html/draft-ietf-oauth-assertions-02">draft-ietf-oauth-assertions-02</a>

   o  Added text about limited lifetime ATs and RTs per
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08298.html">http://www.ietf.org/mail-archive/web/oauth/current/msg08298.html</a>.

   o  Changed the line breaks in some examples to avoid awkward
      rendering to text format.  Also removed encoded &#x27;=&#x27; padding from a
      few examples because both known derivative specs, SAML and JWT,
      omit the padding char in serialization/encoding.

   o  Remove <a href="#section-7">section 7</a> on error responses and move that (somewhat
      modified) content into subsections of <a href="#section-4">section 4</a> broken up by
      authn/authz per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08735.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08735.html">archive/web/oauth/current/msg08735.html</a>.

   o  Rework the text about &quot;MUST validate ... in order to establish a
      mapping between ...&quot; per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08872.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08872.html">archive/web/oauth/current/msg08872.html</a> and <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08749.html">http://www.ietf.org/</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08749.html">mail-archive/web/oauth/current/msg08749.html</a>.

   o  Change &quot;The Principal MUST identify an authorized accessor.  If
      the assertion is self-issued, the Principal SHOULD be the
      client_id&quot; in 6.1 per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08873.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08873.html">archive/web/oauth/current/msg08873.html</a>.

   o  Update reference in 4.1 to point to 2.3 (rather than 3.2) of
      oauth-v2 (rather than self) <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08874.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08874.html">archive/web/oauth/current/msg08874.html</a>.

   o  Move the &quot;<a href="#section-3">Section 3</a> of&quot; out of the xref to hopefully fix the link
      in 4.1 and remove the client_id bullet from 4.2 per
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08875.html">http://www.ietf.org/mail-archive/web/oauth/current/msg08875.html</a>.

   o  Add ref to <a href="#section-3.3">Section 3.3</a> of oauth-v2 for scope definition and remove
      some then redundant text per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08890.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08890.html">archive/web/oauth/current/msg08890.html</a>.



<span class="grey">Campbell, et al.         Expires April 24, 2015                [Page 22]</span></pre>
<hr class='noprint'/><!--NewPage--><pre class='newpage'><span id="page-23" ></span>
<span class="grey">Internet-Draft          OAuth Assertion Framework           October 2014</span>


   o  Change &quot;The following format and processing rules SHOULD be
      applied&quot; to &quot;The following format and processing rules apply&quot; in
      sections <a href="#section-6">6</a>.x to remove conflicting normative qualification of
      other normative statements per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08892.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08892.html">archive/web/oauth/current/msg08892.html</a>.

   o  Add text the client_id must id the client to 4.1 and remove
      similar text from other places per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08893.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08893.html">archive/web/oauth/current/msg08893.html</a>.

   o  Remove the MUST from the text prior to the HTTP parameter
      definitions per <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08920.html">http://www.ietf.org/mail-</a>
      <a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08920.html">archive/web/oauth/current/msg08920.html</a>.

   o  Updated examples to use grant_type and client_assertion_type
      values from the OAuth SAML Assertion Profiles spec.

Authors&#x27; Addresses

   Brian Campbell
   Ping Identity

   Email: brian.d.campbell@gmail.com


   Chuck Mortimore
   Salesforce.com

   Email: cmortimore@salesforce.com


   Michael B. Jones
   Microsoft

   Email: mbj@microsoft.com


   Yaron Y. Goland
   Microsoft

   Email: yarong@microsoft.com










Campbell, et al.         Expires April 24, 2015                [Page 23]
</pre>
    </div>

  </div>


        
	  </div>

	

	

    </div>

      
      <script>$(".visible-nojs").removeClass("visible-nojs");</script>
      <script>$(".hidden-nojs").removeClass("hidden-nojs");</script>
      
    <script type="text/javascript"><!--
    var legend_html = "Colour legend:<br /> \
     <table> \
        <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
        <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr> \
    </table>";
    function showLegend() {
        var elem = document.getElementById('legend');
        elem.innerHTML = legend_html
        elem.style.visibility='visible';
    }
    function hideLegend() {
        var elem = document.getElementById('legend');
        elem.style.visibility='hidden';
        elem.innerHTML = "";
    }
    // -->
    </script>

  </body>
</html>

